<!-- build time:Sun Jul 28 2024 14:09:30 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://blog.xcu.icu/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://blog.xcu.icu/atom.xml"><link rel="alternate" type="application/json" href="https://blog.xcu.icu/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Python"><link rel="canonical" href="https://blog.xcu.icu/2024/06/15/Casualessay/Scan_Python/"><title>Scan_Python - 随笔 | ClownのBlog =</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Scan_Python</h1><div class="meta"><span class="item" title="创建时间：2024-06-15 12:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-06-15T12:00:00+08:00">2024-06-15</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>15k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>38 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ClownのBlog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/148.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/77.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/27.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/26.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/32.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/36.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="item" rel="index" title="分类于 随笔"><span itemprop="name">随笔</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xcu.icu/2024/06/15/Casualessay/Scan_Python/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Clown"><meta itemprop="description" content=", 一个妄想全栈web小废物"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2><p>写了一个简单的信息收集的小工具练手，这里简单记录一下</p><h2 id="被动信息收集"><a class="anchor" href="#被动信息收集">#</a> 被动信息收集</h2><p>被动信息搜集主要通过搜索引擎或者社交等方式对目标资产信息进行提取，通常包括 IP 查询、Whois 查询、子域名搜集等。进行被动信息搜集时不与目标产生交互，可以在不接触到目标系统的情况下挖掘目标信息。主要方法包括: DNS 解析、子域名挖掘、邮件爬取等。</p><h3 id="dns解析"><a class="anchor" href="#dns解析">#</a> DNS 解析</h3><p>DNS (Domain Name System, 域名系统) 是一种分布式网络目录服务，主要用于域名与 IP 地址的相互转换，能够使用户更方便地访问互联网，而不用去记住长串数字 (能够被机器直接读取的 IP)。</p><h4 id="ip查询"><a class="anchor" href="#ip查询">#</a> IP 查询</h4><p>IP 查询是通过当前所获取到的 URL 去在询对应 1P 地址的过程，可以应用 Socket 库函数中的 gethostbyname () 获取域名所对应的 IP 值。</p><p>例如要查询 www.baidu.com 的 ip 代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">getIp</span><span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> socket<span class="token punctuation">.</span>gethostbyname<span class="token punctuation">(</span>domain<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>gaierror<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"域名：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>domain<span class="token punctuation">&#125;</span></span><span class="token string">，解析失败，请检查域名和网络情况！"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"unknow"</span></pre></td></tr></table></figure><p>输出结果如下图所示</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151201331.png" alt="image-20240708151201331"></p><h4 id="whois查询"><a class="anchor" href="#whois查询">#</a> Whois 查询</h4><p>Whois 是用来查询域名的 IP 以及所有者信息的传输协议。简单地说，Whois 就是一个数据库，用来查询域名是否已经被注册，以及注册域名的详细信息 (如域名所有人、域名注册商等)。Python 中的模块 python-whois 可用于 Whois 的查询。</p><p>例如查询 whios 信息代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">getWhois</span><span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    data <span class="token operator">=</span> whois<span class="token punctuation">(</span>domain<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> data</pre></td></tr></table></figure><p>输出结果如下图所示：</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/clip_image004.png" alt="img"></p><h3 id="子域名挖掘"><a class="anchor" href="#子域名挖掘">#</a> 子域名挖掘</h3><p>域名可以分为顶级域名、一级域名、二级域名等。子域名 (subdomain) 是顶级域名 (一级域名或父域名) 的下一级。例如，<span class="exturl" data-url="aHR0cDovL21haWwuZXhhbXBsZS5jb20=">mail.example.com</span> 和 calendar.example.com 是 example.com 的两个子域，<span class="exturl" data-url="aHR0cDovL3huLS1leGFtcGxlLWxpN3MueG4tLWNvbS1vaDJlMDd4ZDh3MmUzYmZmNWIuY29t">而 example.com 则是顶级域.com</span> 的子域。在测试过程中，测试目标主站时如果未发现任何相关漏洞，此时通常会考虑挖掘目标系统的子域名。子域名挖掘方法有很多种，例如，搜索引擎、子域名破解、字典查询等。</p><p>下面代码展示了如何使用 bing 挖掘子域名</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">fetch_page</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> page<span class="token punctuation">,</span> referer<span class="token punctuation">,</span> subdomain_set<span class="token punctuation">,</span> lock<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    url_Bing <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"https://cn.bing.com/search?q=site:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>domain<span class="token punctuation">&#125;</span></span><span class="token string">&amp;sp=-1&amp;lq=0&amp;sc=10-4&amp;qs=n&amp;sk=&amp;cvid=F993D91E93DA4D41A87332F46DCCE8D9&amp;ghsh=0&amp;ghacc=0&amp;ghpl=&amp;FPIG=A5413BF8850E43A6A63AFD447FF4FFB2%2cA905EB2EEAA244B0B446E1179BFBBAB0&amp;first=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">&amp;FORM=PERE2"</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    html <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_Bing<span class="token punctuation">,</span> headers<span class="token operator">=</span>common<span class="token punctuation">.</span>headers_dic<span class="token punctuation">(</span>referer<span class="token operator">=</span>referer<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    job_bt <span class="token operator">=</span> soup<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">with</span> lock<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">for</span> i <span class="token keyword">in</span> job_bt<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            link <span class="token operator">=</span> i<span class="token punctuation">.</span>a<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            domain_l <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">.</span>netloc  <span class="token comment"># 取域名</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            subdomain_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>domain_l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">def</span> <span class="token function">getDomain_by_Bing</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> pages<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    subdomain_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    subdomain_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>domain<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    referer <span class="token operator">=</span> <span class="token string">"https://www.google.com/"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>fetch_page<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> i<span class="token punctuation">,</span> referer<span class="token punctuation">,</span> subdomain_set<span class="token punctuation">,</span> lock<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>thread<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span>subdomain_set<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 使用收集到的子域名进行再一次收集</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">def</span> <span class="token function">secondary_collection</span><span class="token punctuation">(</span>subdomains<span class="token punctuation">,</span> pages<span class="token punctuation">,</span> all_subdomains<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    referer <span class="token operator">=</span> <span class="token string">"https://www.google.com/"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">for</span> subdomain <span class="token keyword">in</span> subdomains<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>fetch_page<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>subdomain<span class="token punctuation">,</span> pages<span class="token punctuation">,</span> referer<span class="token punctuation">,</span> all_subdomains<span class="token punctuation">,</span> lock<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>thread<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151226724.png" alt="image-20240708151226724"></p><p><strong>2.3</strong> <strong>邮件爬取</strong></p><p>在针对目标系统进行渗透的过程中，如果目标服务器安全性很高，通过服务器很难获取目标权限时，通常会采用社工的方式对目标服务进行进一步攻击。 邮件钓鱼攻击是常见的攻击方式之一。在进行钓鱼之前，需要针对目标相关人员的邮件信息进行全面采集。</p><p>此处邮件采集工具主要通过国内常见的搜索引擎 (百度、Bing 等) 进行搜集。针对搜索界面的相关邮件信息进行爬取、处理等操作之后。利用获得的邮箱账号批量发送钓鱼邮件，诱骗、欺诈目标用户或者管理员进行账号登录或者点击执行，进而获取目标系统的权限。</p><p>代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#使用 Bing 检索邮箱</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">bing_search_email</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span>page<span class="token punctuation">,</span>key_word<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    reffer <span class="token operator">=</span> <span class="token string">"https://www.bing.com/"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    url_Bing <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"https://cn.bing.com/search?q=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>key_word<span class="token punctuation">&#125;</span></span><span class="token string">+site:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>domain<span class="token punctuation">&#125;</span></span><span class="token string">&amp;qs=n&amp;sp=-1&amp;pq=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>key_word<span class="token punctuation">&#125;</span></span><span class="token string">site:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>domain<span class="token punctuation">&#125;</span></span><span class="token string">&amp;first=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">&amp;FORM=PERE1"</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># print(url_Bing)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    conn <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span>reffer<span class="token punctuation">,</span> headers<span class="token operator">=</span>common<span class="token punctuation">.</span>headers_dic<span class="token punctuation">(</span>reffer<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    html <span class="token operator">=</span> conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_Bing<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>common<span class="token punctuation">.</span>headers_dic<span class="token punctuation">(</span>reffer<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> common<span class="token punctuation">.</span>re_email<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#使用百度检索邮箱</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">def</span> <span class="token function">baidu_search_email</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span>page<span class="token punctuation">,</span>key_word<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    email_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    emails <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    reffer <span class="token operator">=</span> <span class="token string">"https://www.baidu.com/"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment"># print(page)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    url_Baidu <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"https://www.baidu.com/s?ie=utf-8&amp;wd=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>key_word<span class="token punctuation">&#125;</span></span><span class="token string">+site:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>domain<span class="token punctuation">&#125;</span></span><span class="token string">&amp;pn=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment"># print(url_Baidu)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    conn <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span>reffer<span class="token punctuation">,</span> headers<span class="token operator">=</span>common<span class="token punctuation">.</span>headers_dic<span class="token punctuation">(</span>reffer<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    html <span class="token operator">=</span> conn<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_Baidu<span class="token punctuation">,</span> headers<span class="token operator">=</span>common<span class="token punctuation">.</span>headers_dic<span class="token punctuation">(</span>reffer<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    tagh3 <span class="token operator">=</span> soup<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">for</span> h3 <span class="token keyword">in</span> tagh3<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        href <span class="token operator">=</span> h3<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>href<span class="token punctuation">,</span> headers<span class="token operator">=</span>common<span class="token punctuation">.</span>headers_dic<span class="token punctuation">(</span>reffer<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            emails <span class="token operator">=</span> common<span class="token punctuation">.</span>re_email<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">for</span> email <span class="token keyword">in</span> emails<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            email_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>email<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">return</span> email_list</pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">def</span> <span class="token function">search_emails</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> page<span class="token punctuation">,</span> key_word<span class="token punctuation">,</span> email_set<span class="token punctuation">,</span> lock<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    bing_emails <span class="token operator">=</span> bing_search_email<span class="token punctuation">(</span>domain<span class="token punctuation">,</span> page<span class="token punctuation">,</span> key_word<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    baidu_emails <span class="token operator">=</span> baidu_search_email<span class="token punctuation">(</span>domain<span class="token punctuation">,</span> page<span class="token punctuation">,</span> key_word<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    all_emails <span class="token operator">=</span> bing_emails <span class="token operator">+</span> baidu_emails</pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token comment"># all_emails = bing_emails</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">with</span> lock<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">for</span> email <span class="token keyword">in</span> all_emails<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            email_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>email<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">def</span> <span class="token function">launcher_mail</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> pages<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    email_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    key_words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'mail'</span><span class="token punctuation">,</span> <span class="token string">'mailbox'</span><span class="token punctuation">,</span> <span class="token string">'postbox'</span><span class="token punctuation">,</span> <span class="token string">'邮件'</span><span class="token punctuation">,</span> <span class="token string">'邮箱'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">for</span> key_word <span class="token keyword">in</span> key_words<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>search_emails<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> page<span class="token punctuation">,</span> key_word<span class="token punctuation">,</span> email_set<span class="token punctuation">,</span> lock<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>thread<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span>email_set<span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用如下图所示：</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151243970.png" alt="image-20240708151243970"></p><h2 id="主动信息收集"><a class="anchor" href="#主动信息收集">#</a> 主动信息收集</h2><p>在内网中，好的信息搜集能力能够帮助开发者更快地拿到权限及达成目标。内网里数据多种多样，需要根据需求寻找任何能对下一步渗透行动有所帮助的信息。信息搜集能力是渗透过程中不可或缺的重要一步。</p><h3 id="基于-icmp的主机发现"><a class="anchor" href="#基于-icmp的主机发现">#</a> 基于 ICMP 的主机发现</h3><p>ICMP (Internet Control Message Protocol, Internet 报文协议) 是 TCP/IP 的一种子协议，位于 OSI7 层网络模型中的网络层，其目的是用于在 IP 主机、路由器之间传递控制消息。Ping 命令是 ICMP 中较为常见的一种应用，经常使用这个命令来测试本地与目标之间的连通性，发送一个 ICMP 请求消息给目标主机，若源主机收到目标主机的应答响应消息，则表示目标可达，主机存在。</p><p>使用 nmap 实现代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">ttl_scan</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    ttlstrmatch <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'ttl=\d+'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    ttlnummatch <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'\d+'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    result <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ping -c 1 '</span><span class="token operator">+</span>ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    res <span class="token operator">=</span> result<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> line <span class="token keyword">in</span> res<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        result <span class="token operator">=</span> ttlstrmatch<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>line<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">if</span> result<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            ttl <span class="token operator">=</span> ttlnummatch<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ttl<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">64</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                Log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'Linux/UNIX'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                Log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'Windows'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">def</span> <span class="token function">scan_nmap</span><span class="token punctuation">(</span>target_ip<span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> prot<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> icmp<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> tcp<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> version<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> os_detect<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    nm <span class="token operator">=</span> nmap<span class="token punctuation">.</span>PortScanner<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    arguments <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f""</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">if</span> prot<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" -p </span><span class="token interpolation"><span class="token punctuation">&#123;</span>prot<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">if</span> icmp<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -sn"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">if</span> tcp<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -sT"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">if</span> version<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -sV"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span> os_detect<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment"># scan_nmap(target_ip, level=level,os_detect=os_detect)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -O"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">if</span> level <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" --min-parallelism </span><span class="token interpolation"><span class="token punctuation">&#123;</span>level<span class="token punctuation">&#125;</span></span><span class="token string"> --max-parallelism </span><span class="token interpolation"><span class="token punctuation">&#123;</span>level<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"使用Nmap进行扫描，目标: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_ip<span class="token punctuation">&#125;</span></span><span class="token string">，参数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>arguments<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        nm<span class="token punctuation">.</span>scan<span class="token punctuation">(</span>hosts<span class="token operator">=</span>target_ip<span class="token punctuation">,</span> arguments<span class="token operator">=</span>arguments<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        Log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"扫描完成。"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">for</span> host <span class="token keyword">in</span> nm<span class="token punctuation">.</span>all_hosts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token keyword">if</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">.</span>state<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"up"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>host<span class="token punctuation">&#125;</span></span><span class="token string"> 是在线的"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token keyword">if</span> prot <span class="token keyword">or</span> tcp<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                    <span class="token keyword">for</span> proto <span class="token keyword">in</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">.</span>all_protocols<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                        Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"协议: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proto<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                        lport <span class="token operator">=</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                        <span class="token keyword">for</span> port <span class="token keyword">in</span> lport<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"端口: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span></span><span class="token string">\t状态: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">[</span>port<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>                <span class="token keyword">if</span> version<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                    <span class="token keyword">for</span> proto <span class="token keyword">in</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">.</span>all_protocols<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                        <span class="token keyword">if</span> proto <span class="token operator">==</span> <span class="token string">'tcp'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"检测到版本信息:"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                            <span class="token keyword">for</span> port <span class="token keyword">in</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                                service <span class="token operator">=</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">[</span>port<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                                Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"端口: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span></span><span class="token string">\t服务: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>service<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\t版本: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>service<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token keyword">if</span> os_detect<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'osmatch'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                        ttl_scan<span class="token punctuation">(</span>target_ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                        Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"操作系统检测结果:"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                        Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'osmatch'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                Log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>host<span class="token punctuation">&#125;</span></span><span class="token string"> 没有响应"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"扫描出错: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">def</span> <span class="token function">scan_ip_nmap</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> prot<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>icmp<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>tcp<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>Version<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>os_detect<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"开始扫描: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span></span><span class="token string">，线程等级: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>level<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">if</span> <span class="token string">'/'</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token comment"># 子网扫描</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            network <span class="token operator">=</span> ipaddress<span class="token punctuation">.</span>ip_network<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> strict<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"子网扫描: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>network<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            scan_nmap<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>network<span class="token punctuation">)</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> prot<span class="token punctuation">,</span>icmp<span class="token punctuation">,</span>tcp<span class="token punctuation">,</span>Version<span class="token punctuation">,</span>os_detect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的子网: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>    <span class="token keyword">elif</span> <span class="token string">'-'</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token comment"># IP 范围扫描，格式为 "start_ip-end_suffix"</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            start_ip<span class="token punctuation">,</span> end_suffix <span class="token operator">=</span> ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            start_ip <span class="token operator">=</span> ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>start_ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre>            end_suffix <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>end_suffix<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            start_suffix <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>start_ip<span class="token punctuation">.</span>packed<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token keyword">if</span> start_suffix <span class="token operator">></span> end_suffix<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"起始后缀应小于或等于结束后缀"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            scan_nmap<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> level<span class="token punctuation">,</span> prot<span class="token punctuation">,</span> icmp<span class="token punctuation">,</span>tcp<span class="token punctuation">,</span>Version<span class="token punctuation">,</span>os_detect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的IP范围: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"扫描过程中出错: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token comment"># 单个 IP 扫描</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="99"></td><td><pre>            ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>  <span class="token comment"># 验证 IP 地址</span></pre></td></tr><tr><td data-num="100"></td><td><pre>            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"单个IP扫描: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            scan_nmap<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> level<span class="token punctuation">,</span> prot<span class="token punctuation">,</span> icmp<span class="token punctuation">,</span> tcp<span class="token punctuation">,</span> Version<span class="token punctuation">,</span> os_detect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="103"></td><td><pre>            Log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的IP地址: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用 scapy 实现代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">scan_ip_icmp_scapy</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"开始扫描: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span></span><span class="token string">，线程等级: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>level<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    target_ips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> <span class="token string">'/'</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment"># 子网扫描</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            network <span class="token operator">=</span> ipaddress<span class="token punctuation">.</span>ip_network<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> strict<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            target_ips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token keyword">for</span> host <span class="token keyword">in</span> network<span class="token punctuation">.</span>hosts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的子网: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">elif</span> <span class="token string">'-'</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment"># IP 范围扫描，格式为 "start_ip-end_suffix"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            start_ip<span class="token punctuation">,</span> end_suffix <span class="token operator">=</span> ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            start_ip <span class="token operator">=</span> ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>start_ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            start_ip_base <span class="token operator">=</span> start_ip<span class="token punctuation">.</span>packed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            end_suffix <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>end_suffix<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            start_suffix <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>start_ip<span class="token punctuation">.</span>packed<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">if</span> start_suffix <span class="token operator">></span> end_suffix<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"起始后缀应小于或等于结束后缀"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            target_ips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>start_ip_base <span class="token operator">+</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>suffix<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> suffix <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_suffix<span class="token punctuation">,</span> end_suffix <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的IP范围: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment"># 单个 IP 扫描</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>  <span class="token comment"># 验证 IP 地址</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            target_ips <span class="token operator">=</span> <span class="token punctuation">[</span>ip<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            Log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的IP地址: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">if</span> target_ips<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token keyword">for</span> ip <span class="token keyword">in</span> target_ips<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>        threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>worker_icmp_scapy<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>thread<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>        queue<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用 scapy 扫描效果如下图所示</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151328047.png" alt="image-20240708151328047"></p><p>使用 nmap 扫描如下</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151354573.png" alt="image-20240708151354573"></p><h3 id="基于tcp-udp的主机发现"><a class="anchor" href="#基于tcp-udp的主机发现">#</a> 基于 TCP、UDP 的主机发现</h3><p>基于 TCP、UDP 的主机发现属于四层主机发现，是一个位于传输层的协议。可以用来探测远程主机存活、端口开放、服务类型以及系统类型等信息，相比于三层主机发现 TCP 是一种面向连接的、可靠的传输通信协议，位于 IP 层之上，应用层之下的中间层。</p><p>每一次建立连接都基于三次握手通信，终止 - 一个连接也需要经过四次握手，建立完连接之后，才可以传输数据。当主动方发出 SYN 连接请求后，等待对方回答 TCP 的三次握手 SYN + ACK，并最终对对方的 SYN 执行 ACK 确认。这种建立连接的方法可以防止产生错误的连接，所以 TCP 是一一个可靠的传输协议。因此，我们可以利用 TCP 三次握手原理进行主机存活的探测。当向目标主机直接发送 ACK 数据包时，如果目标主机存活，就会返回一个 RST 数据包以终止这个不正常的 TCP 连接。也可以发送正常的 SYN 数据包，如果目标主机返回 SYN/ACK 或者 RST 数据包，也可以证明目标主机为存活状态。其工作原理主要依据目标主机响应数据包中 flags 字段，如果 flags 字段有值，则表示主机存活，该字段通常包括 SYN、FIN、ACK、PSH、RST、URG 六种类型。SYN 表示建立连接，FIN 表示关闭连接，ACK 表示应答，PSH 表示包含 DATA 数据传输，RST 表示连接重置，URG 表示紧急指针。</p><p>这里选择使用调用 nmap 来实现，代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">ttl_scan</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    ttlstrmatch <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'ttl=\d+'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    ttlnummatch <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'\d+'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    result <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ping -c 1 '</span><span class="token operator">+</span>ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    res <span class="token operator">=</span> result<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> line <span class="token keyword">in</span> res<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        result <span class="token operator">=</span> ttlstrmatch<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>line<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">if</span> result<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            ttl <span class="token operator">=</span> ttlnummatch<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ttl<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">64</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                Log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'Linux/UNIX'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                Log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'Windows'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">def</span> <span class="token function">scan_nmap</span><span class="token punctuation">(</span>target_ip<span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> prot<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> icmp<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> tcp<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> version<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> os_detect<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    nm <span class="token operator">=</span> nmap<span class="token punctuation">.</span>PortScanner<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    arguments <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f""</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">if</span> prot<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" -p </span><span class="token interpolation"><span class="token punctuation">&#123;</span>prot<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">if</span> icmp<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -sn"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">if</span> tcp<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -sT"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">if</span> version<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -sV"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span> os_detect<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment"># scan_nmap(target_ip, level=level,os_detect=os_detect)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string">" -O"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">if</span> level <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        arguments <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" --min-parallelism </span><span class="token interpolation"><span class="token punctuation">&#123;</span>level<span class="token punctuation">&#125;</span></span><span class="token string"> --max-parallelism </span><span class="token interpolation"><span class="token punctuation">&#123;</span>level<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"使用Nmap进行扫描，目标: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_ip<span class="token punctuation">&#125;</span></span><span class="token string">，参数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>arguments<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        nm<span class="token punctuation">.</span>scan<span class="token punctuation">(</span>hosts<span class="token operator">=</span>target_ip<span class="token punctuation">,</span> arguments<span class="token operator">=</span>arguments<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        Log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"扫描完成。"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">for</span> host <span class="token keyword">in</span> nm<span class="token punctuation">.</span>all_hosts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token keyword">if</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">.</span>state<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"up"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>host<span class="token punctuation">&#125;</span></span><span class="token string"> 是在线的"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token keyword">if</span> prot <span class="token keyword">or</span> tcp<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                    <span class="token keyword">for</span> proto <span class="token keyword">in</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">.</span>all_protocols<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                        Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"协议: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proto<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                        lport <span class="token operator">=</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                        <span class="token keyword">for</span> port <span class="token keyword">in</span> lport<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"端口: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span></span><span class="token string">\t状态: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">[</span>port<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>                <span class="token keyword">if</span> version<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                    <span class="token keyword">for</span> proto <span class="token keyword">in</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">.</span>all_protocols<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                        <span class="token keyword">if</span> proto <span class="token operator">==</span> <span class="token string">'tcp'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"检测到版本信息:"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                            <span class="token keyword">for</span> port <span class="token keyword">in</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                                service <span class="token operator">=</span> nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">[</span>port<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                                Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"端口: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span></span><span class="token string">\t服务: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>service<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\t版本: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>service<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token keyword">if</span> os_detect<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'osmatch'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                        ttl_scan<span class="token punctuation">(</span>target_ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                        Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"操作系统检测结果:"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                        Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nm<span class="token punctuation">[</span>host<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'osmatch'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                Log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>host<span class="token punctuation">&#125;</span></span><span class="token string"> 没有响应"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"扫描出错: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">def</span> <span class="token function">scan_ip_nmap</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> prot<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>icmp<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>tcp<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>Version<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>os_detect<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"开始扫描: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span></span><span class="token string">，线程等级: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>level<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">if</span> <span class="token string">'/'</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token comment"># 子网扫描</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            network <span class="token operator">=</span> ipaddress<span class="token punctuation">.</span>ip_network<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> strict<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"子网扫描: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>network<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            scan_nmap<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>network<span class="token punctuation">)</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> prot<span class="token punctuation">,</span>icmp<span class="token punctuation">,</span>tcp<span class="token punctuation">,</span>Version<span class="token punctuation">,</span>os_detect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的子网: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>    <span class="token keyword">elif</span> <span class="token string">'-'</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token comment"># IP 范围扫描，格式为 "start_ip-end_suffix"</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            start_ip<span class="token punctuation">,</span> end_suffix <span class="token operator">=</span> ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            start_ip <span class="token operator">=</span> ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>start_ip<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre>            end_suffix <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>end_suffix<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            start_suffix <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>start_ip<span class="token punctuation">.</span>packed<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token keyword">if</span> start_suffix <span class="token operator">></span> end_suffix<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"起始后缀应小于或等于结束后缀"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            scan_nmap<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> level<span class="token punctuation">,</span> prot<span class="token punctuation">,</span> icmp<span class="token punctuation">,</span>tcp<span class="token punctuation">,</span>Version<span class="token punctuation">,</span>os_detect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的IP范围: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"扫描过程中出错: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token comment"># 单个 IP 扫描</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="99"></td><td><pre>            ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>  <span class="token comment"># 验证 IP 地址</span></pre></td></tr><tr><td data-num="100"></td><td><pre>            Log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"单个IP扫描: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            scan_nmap<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> level<span class="token punctuation">,</span> prot<span class="token punctuation">,</span> icmp<span class="token punctuation">,</span> tcp<span class="token punctuation">,</span> Version<span class="token punctuation">,</span> os_detect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="103"></td><td><pre>            Log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效的IP地址: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用演示如下：</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151429340.png" alt="image-20240708151429340"></p><p>4 网络空间搜索引擎</p><p>随着互联网、物联网、传感网、社交网络等信息系统所构成的泛在网络不断发展，网络终端设备数量呈指数级上升。这为企业进行终端设备资产清点和统一管控带来了巨大挑战，同时也引发了一系列安全问题，网络攻击与防御的博弈从单边代码漏洞发展到了大数据对抗阶段，网络空间搜索引擎应运而生。</p><p>搜索引擎是指从互联网搜集信息，经过一定整理以后，提供给用户进行查询的系统。传统搜索引擎对我们来说并不陌生，像 Google、百度等，每天我们几乎都会用它们来搜索消息。与传统搜索引擎相比，网络空间搜索引擎有很大不同，其搜索目标为全球的 IF 地址，实时扫描互联网和解析各种设备，对网络中的设备进行探测识别和指纹分析，并将其扫描的目标信息进行分布式存储，供需求者检索使用。传统的网络空间搜索模型柜架一 - 般由五部分组成：扫描和指纹识别、分布存储、索引、UI 界面以及调度程序。</p><p>这里选择使用调用 zoomeye，代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">zoomeye_search</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    url <span class="token operator">=</span> <span class="token string">'https://api.zoomeye.hk/web/search'</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>query<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">'page'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>page<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">'API-KEY'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">#替换为自己的 key</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0'</span>  <span class="token comment"># 设置用户代理，通常需要提供</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    proxy_host <span class="token operator">=</span> <span class="token string">'localhost'</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    proxy_port <span class="token operator">=</span> <span class="token number">7897</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    proxy_handler <span class="token operator">=</span> request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'http://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>proxy_host<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>proxy_port<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token string">'https'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'https://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>proxy_host<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>proxy_port<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    opener <span class="token operator">=</span> request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>proxy_handler<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    request<span class="token punctuation">.</span>install_opener<span class="token punctuation">(</span>opener<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        full_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">?</span><span class="token interpolation"><span class="token punctuation">&#123;</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>        req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>full_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>getcode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            data <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求失败，状态码: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">.</span>getcode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发生异常: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_site_info</span><span class="token punctuation">(</span>json_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    matches <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> matches<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"No matches found."</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>    reports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">for</span> <span class="token keyword">match</span> <span class="token keyword">in</span> matches<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token comment"># 网站概况</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        site_info <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token string">"网站"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token string">"网址"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"site"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token string">"标题"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token string">"关键词"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"keywords"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token string">"描述"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token string">"关联域名"</span><span class="token punctuation">:</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"domains"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token comment"># 服务器信息</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        server_info <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token string">"服务器"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"headers"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"Server: "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token string">"Server: "</span> <span class="token keyword">in</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"headers"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">""</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token string">"IP地址"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token string">"端口信息"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"portinfo"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token string">"位置"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"subdivisions"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"names"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"省"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                   <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"city"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"names"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token string">"组织"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"organization"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token comment"># 地理信息</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        geoinfo <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token string">"洲"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"continent"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"names"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token string">"国家"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"country"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"names"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token string">"城市"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"city"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"names"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            <span class="token string">"区"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"district"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"names"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token string">"时区"</span><span class="token punctuation">:</span> <span class="token keyword">match</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"geoinfo"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"timezone"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token comment"># 生成单个报告</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        report <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token string">"网站概况\n"</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"网站：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>site_info<span class="token punctuation">[</span><span class="token string">'网站'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="78"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"网址：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>site_info<span class="token punctuation">[</span><span class="token string">'网址'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="79"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"标题：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>site_info<span class="token punctuation">[</span><span class="token string">'标题'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"关键词：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>site_info<span class="token punctuation">[</span><span class="token string">'关键词'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="81"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"描述：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>site_info<span class="token punctuation">[</span><span class="token string">'描述'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="82"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"关联域名：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>site_info<span class="token punctuation">[</span><span class="token string">'关联域名'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n\n"</span></span></pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token string">"服务器信息\n"</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"服务器：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>server_info<span class="token punctuation">[</span><span class="token string">'服务器'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="85"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"IP地址：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>server_info<span class="token punctuation">[</span><span class="token string">'IP地址'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"端口信息：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>server_info<span class="token punctuation">[</span><span class="token string">'端口信息'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"位置：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>server_info<span class="token punctuation">[</span><span class="token string">'位置'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="88"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"组织：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>server_info<span class="token punctuation">[</span><span class="token string">'组织'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n\n"</span></span></pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token string">"地理信息\n"</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"洲：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>geoinfo<span class="token punctuation">[</span><span class="token string">'洲'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="91"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"国家：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>geoinfo<span class="token punctuation">[</span><span class="token string">'国家'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="92"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"城市：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>geoinfo<span class="token punctuation">[</span><span class="token string">'城市'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="93"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"区：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>geoinfo<span class="token punctuation">[</span><span class="token string">'区'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token string-interpolation"><span class="token string">f"时区：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>geoinfo<span class="token punctuation">[</span><span class="token string">'时区'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span></pre></td></tr><tr><td data-num="95"></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre>        reports<span class="token punctuation">.</span>append<span class="token punctuation">(</span>report<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token comment"># 合并所有报告</span></pre></td></tr><tr><td data-num="99"></td><td><pre>    final_report <span class="token operator">=</span> <span class="token string">"\n\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>reports<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="100"></td><td><pre>    <span class="token keyword">return</span> final_report</pre></td></tr><tr><td data-num="101"></td><td><pre></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token keyword">def</span> <span class="token function">fetch_all_pages</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> max_page<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="103"></td><td><pre>    reports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="104"></td><td><pre>    <span class="token keyword">with</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        future_to_page <span class="token operator">=</span> <span class="token punctuation">&#123;</span>executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>zoomeye_search<span class="token punctuation">,</span> query<span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">:</span> page <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>max_page<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>        <span class="token keyword">for</span> future <span class="token keyword">in</span> as_completed<span class="token punctuation">(</span>future_to_page<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="107"></td><td><pre>            page <span class="token operator">=</span> future_to_page<span class="token punctuation">[</span>future<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="108"></td><td><pre>            <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="109"></td><td><pre>                data <span class="token operator">=</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="110"></td><td><pre>                <span class="token keyword">if</span> data<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="111"></td><td><pre>                    report <span class="token operator">=</span> extract_site_info<span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="112"></td><td><pre>                    reports<span class="token punctuation">.</span>append<span class="token punctuation">(</span>report<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="113"></td><td><pre>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="114"></td><td><pre>                Log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"页面 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>page<span class="token punctuation">&#125;</span></span><span class="token string"> 处理时发生异常: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre>    final_report <span class="token operator">=</span> <span class="token string">"\n\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>reports<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    <span class="token keyword">return</span> final_report</pre></td></tr></table></figure><p>使用效果图如下：</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151520653.png" alt="image-20240708151520653"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20240708151457827.png" alt="image-20240708151457827"></p><div class="tags"><a href="/tags/Python/" rel="tag"><i class="ic i-tag"></i> Python</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-06-15 12:00:00" itemprop="dateModified" datetime="2023-06-15T12:00:00+08:00">2023-06-15</time> </span><span id="2024/06/15/Casualessay/Scan_Python/" class="item leancloud_visitors" data-flag-title="Scan_Python" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Clown <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xcu.icu/2024/06/15/Casualessay/Scan_Python/" title="Scan_Python">https://blog.xcu.icu/2024/06/15/Casualessay/Scan_Python/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/06/10/java%E5%AE%89%E5%85%A8/%E8%8B%A5%E4%BE%9Dv4.6.0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;note-1311335427.cos.ap-shanghai.myqcloud.com&#x2F;images&#x2F;142.jpg" title="若依v4.6.0代码审计"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> java安全</span><h3>若依v4.6.0代码审计</h3></a></div><div class="item right"><a href="/2024/06/29/InternalNet/ACK3/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;note-1311335427.cos.ap-shanghai.myqcloud.com&#x2F;images&#x2F;5.jpg" title="红日靶机3"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 内网</span><h3>红日靶机3</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A2%AB%E5%8A%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">被动信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dns%E8%A7%A3%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">DNS 解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ip%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.1.1.</span> <span class="toc-text">IP 查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#whois%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.1.2.</span> <span class="toc-text">Whois 查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E6%8C%96%E6%8E%98"><span class="toc-number">2.2.</span> <span class="toc-text">子域名挖掘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.</span> <span class="toc-text">主动信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-icmp%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0"><span class="toc-number">3.1.</span> <span class="toc-text">基于 ICMP 的主机发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Etcp-udp%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0"><span class="toc-number">3.2.</span> <span class="toc-text">基于 TCP、UDP 的主机发现</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2024/05/15/Casualessay/ArchLinux%E4%B8%80%E6%96%87%E5%88%B0%E5%BA%95/" rel="bookmark" title="Arch一文到底">Arch一文到底</a></li><li class="active"><a href="/2024/06/15/Casualessay/Scan_Python/" rel="bookmark" title="Scan_Python">Scan_Python</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Clown" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Clown</p><div class="description" itemprop="description">一个妄想全栈web小废物</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">113</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">18</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">62</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3duLXE=" title="https:&#x2F;&#x2F;github.com&#x2F;clown-q"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjI2NDIxMzczNjVAcXEuY29t" title="mailto:2642137365@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/06/10/java%E5%AE%89%E5%85%A8/%E8%8B%A5%E4%BE%9Dv4.6.0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/06/29/InternalNet/ACK3/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Vulnhub/" title="分类于 Vulnhub">Vulnhub</a></div><span><a href="/2023/07/14/Vulnhub/easy_cloudantivirus%E9%9D%B6%E6%9C%BA%E6%94%BB%E5%87%BB%E8%AE%B0%E5%BD%95/" title="记一次easy_cloudantivirus打靶记录">记一次easy_cloudantivirus打靶记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="分类于 数据结构">数据结构</a></div><span><a href="/2022/10/24/Casualessay/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8/" title="数据结构与算法入门">数据结构与算法入门</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 Web">Web</a></div><span><a href="/2022/11/02/web/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/" title="php反序列化">php反序列化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/05/24/java%E5%AE%89%E5%85%A8/CommonsCollections-6/" title="ConmonsCollection-6">ConmonsCollection-6</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/04/14/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="java反序列化">java反序列化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 Web">Web</a></div><span><a href="/2024/04/15/web/kitecms%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" title="KiteCMS代码审计">KiteCMS代码审计</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2024/06/10/java%E5%AE%89%E5%85%A8/%E8%8B%A5%E4%BE%9Dv4.6.0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" title="若依v4.6.0代码审计">若依v4.6.0代码审计</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 Web">Web</a></div><span><a href="/2023/03/20/web/%E8%A2%AB%E5%8A%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="被动信息收集">被动信息收集</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/InternalNet/" title="分类于 内网">内网</a></div><span><a href="/2024/03/06/InternalNet/MSF%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="MSF工具的基本使用">MSF工具的基本使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/03/26/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%B0%84/" title="java反射">java反射</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Clown @ ClownのBlog</span></div><div class="timing"><span id="RunTime"></span><script>var BootDate = new Date("2022/9/23 23:00:00"); &#123;# 站点起始时间 #&#125;
    function ShowRunTime(id) {
      var NowDate = new Date();
      var RunDateM = parseInt(NowDate - BootDate);
      var RunDays = Math.floor(RunDateM/(24*3600*1000));
      var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
      var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
      var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
      var RunTime = RunDays + " &#123;&#123; __('footer.days') &#125;&#125; " + RunHours + " &#123;&#123; __('footer.hours') &#125;&#125; " + RunMinutes + " &#123;&#123; __('footer.minutes') &#125;&#125; " + RunSeconds + " &#123;&#123; __('footer.seconds') &#125;&#125;";
      document.getElementById(id).innerHTML = "&#123;&#123; __('footer.timing') &#125;&#125; " + RunTime;
    }
    setInterval("ShowRunTime('RunTime')", 1000);</script></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.1m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">45:13</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/06/15/Casualessay/Scan_Python/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->