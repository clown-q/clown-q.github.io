<!-- build time:Sun Nov 06 2022 14:42:58 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://blog.xcu.icu/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://blog.xcu.icu/atom.xml"><link rel="alternate" type="application/json" href="https://blog.xcu.icu/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="XSS"><link rel="canonical" href="https://blog.xcu.icu/2022/10/29/XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB/"><title>XSS跨站脚本攻击 - Web | ClownのBlog =</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">XSS跨站脚本攻击</h1><div class="meta"><span class="item" title="创建时间：2022-10-29 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-10-29T00:00:00+08:00">2022-10-29</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ClownのBlog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclh5u05ej20zk0m87df.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeubcbajj20zk0m8h1h.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipey84bjtj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicljgocqbj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclfdu6exj20zk0m87hw.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipevuctzzj20zk0m84qp.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Web/" itemprop="item" rel="index" title="分类于 Web"><span itemprop="name">Web</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xcu.icu/2022/10/29/XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Clown"><meta itemprop="description" content=", 一个妄想全栈web小废物的博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h1 id="xss跨站脚本攻击"><a class="anchor" href="#xss跨站脚本攻击">#</a> XSS 跨站脚本攻击</h1><p>xss 也叫 css 为了和层叠样式表（Cascading Style Sheets，CSS）的缩写区分。因此将跨站脚本攻击缩写为 XSS。</p><p>xss 攻击是指攻击者在网页中嵌入客户端脚本，通常是 js 代码，在用户访问时，恶意代码执行</p><h1 id="原理刨析"><a class="anchor" href="#原理刨析">#</a> 原理刨析</h1><p>攻击者可以通过一些方式向网页中写入恶意代码，导致用户在加载网页时浏览器渲染执行了恶意脚本</p><p>上面提到 xss 攻击是嵌入客户端脚本，大多数是 js，少部分使用 AS 和 VBS，那么也就是说在能够利用漏洞的情况下，js 能做到什么效果，xss 的利用就能做到什么效果</p><p><pre class="line-numbers language-none"><code class="language-none">javaScript加载外部的代码文件可以是任意文件扩展名，即使是图片扩展名只要包含js代码就能执行<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="xss分类"><a class="anchor" href="#xss分类">#</a> xss 分类</h1><p>主要被分为三种，反射型，储存型和 DOM 型，接下来详细说明</p><h3 id="反射型"><a class="anchor" href="#反射型">#</a> 反射型</h3><p>首先，先盗个图</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20221025215134992.png" alt="image-20221025215134992"></p><p>反射型 xss 也被称为非持久型的 xss，反射型 xss 是当先最常见的一种 xss 漏洞。攻击者将带有 xss 恶意脚本的连接发给用户诱导其点击，用户向服务器请求了一个带有 xss 脚本的 url 请求，服务器返回给浏览器，浏览器解析 xss 脚本区访问了恶意服务器造成漏洞</p><p>demo</p><p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$name</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hello <span class="token interpolation"><span class="token variable">$name</span></span>"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>服务端对用户的 name 没有进行过滤，服务器解析后通过 echo 插入到 HTML 中</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20221025221057624.png" alt="image-20221025221057624"></p><p>这里插入 js，便可执行</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20221025221207814.png" alt="image-20221025221207814"></p><h3 id="存储型"><a class="anchor" href="#存储型">#</a> 存储型</h3><p>还是先盗个图（我发四，本篇最后一张）</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20221025220126444.png" alt="image-20221025220126444"></p><p>刚刚说到反射型也叫非持久性，那么存储型就是持久型 xss，与 xss 的区别就是提交的 xss 代码是否会被存储在服务端，下次访问到这个页面时还会执行恶意脚本。（存储型 xss 不在是攻击者诱导受害者点击连接，而是将 xss 脚本留在目标服务器上，当受害者访问了存有 xss 脚本的页面时就受到了攻击，允许用户进行数据存储的地方都有可能存在 xss 漏洞，这种 xss 攻击比反射型危害更大。）</p><p>demo</p><p><pre class="line-numbers language-none"><code class="language-none">&lt;?php
echo &quot;&lt;script&gt;alert(&#39;xss&#39;)&lt;&#x2F;script&gt;&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>保存到文件中，每次访问时都会执行</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20221025221521051.png" alt="image-20221025221521051"></p><h3 id="dom型"><a class="anchor" href="#dom型">#</a> DOM 型</h3><p>个人理解其实也算是反射型，但是 DOM 型的 xss 不需要与服务端交互，仅仅发生在客户端处理数据的阶段，DOM 全称 Document Object Model（文档对象模型），对于浏览器来说 DOM 就是一份 xml，JavaScript 重构 HTML 页面的过程中使用 DOM 提供结构化表示，DOM 规定 HTML 中每个成分都是一个结点</p><p><pre class="line-numbers language-none"><code class="language-none">DOM规定：
整个文档是一个文档结点
每一个HTML标签是一个元素结点
包含在HTML元素中的文本是文本结点
每个HTML属性是一个属性结点
结点与结点之间都有等级关系<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>HTML DOM 树</p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20221025224329456.png" alt="image-20221025224329456"></p><p><pre class="line-numbers language-none"><code class="language-none">可能触发DOM型XSS的属性
document.referer属性

window.name属性

location属性

innerHTML属性

documen.write属性<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="dom型xss利用原理"><a class="anchor" href="#dom型xss利用原理">#</a> DOM 型 xss 利用原理</h4><p>利用前提是 js 可以访问 DOM 文本对象模型，如果客户端代码中有 xss 脚本诱导用户点击可以使得用户访问自己构造的 url，达到和反射型类似的效果，因其不与服务器进行交互，可以用来绕过 waf</p><p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> tem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">;</span><span class="token comment">// 获取当前页面的 URL</span>
    <span class="token keyword">var</span> index <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"content="</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">// 获取 content = 后面的内容</span>
    <span class="token keyword">var</span> par <span class="token operator">=</span> tem<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取参数</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>par<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//decodeURI () 解码 // 输出参数</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><img data-src="https://note-1311335427.cos.ap-shanghai.myqcloud.com/images/image-20221026213845778.png" alt="image-20221026213845778"></p><h1 id="xss的检测"><a class="anchor" href="#xss的检测">#</a> Xss 的检测</h1><p>检测 xss 主要有两种方法，一种是手工检测，一种是通过自动化工具检测，个人感觉两种方法没有先后各有利弊吧。手工检测的精度更高，但是当一个 web 应用程序过于庞大的情况，手工检测是非常困难的，用工具自动化检测精度相对要低上不少</p><h3 id="手工检测xss"><a class="anchor" href="#手工检测xss">#</a> 手工检测 xss</h3><p>手工检测时，主要考虑有输出和能够存储的地方进行测试，可以尝试使用特征明显的字符来进行测试</p><p><pre class="line-numbers language-none"><code class="language-none">&lt; &gt; &quot;  &#39; ( )等字符<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>同时携带上如 AAAAAAA 字便于查找插入到 HTML 中的位置</p><h3 id="xss工具"><a class="anchor" href="#xss工具">#</a> Xss 工具</h3><p>这里工具很多不再一一赘述，推荐去 GitHub 上寻找开源的工具</p><h1 id="xss的利用种类"><a class="anchor" href="#xss的利用种类">#</a> Xss 的利用种类</h1><p>在一些情况下 xss 漏洞的危害不亚于 sql 注入，常见的利用方法：</p><ul><li>盗取用户 cookie</li><li>修改网页内容</li><li>网站挂马</li><li>利用网站重定向</li><li>xss 蠕虫</li></ul><h3 id="xss会话劫持"><a class="anchor" href="#xss会话劫持">#</a> xss 会话劫持</h3><p>这里多数是指劫持 cookie 或 session 达到目的</p><h4 id="cookie"><a class="anchor" href="#cookie">#</a> cookie</h4><p>cookie 是一种能够将少量文本存储到客户端的磁盘、内存上面或者从客户端的内存、磁盘上面读取的一种技术</p><p>一位我尊敬的师长说过，每一种技术或者协议的产生都是由需求驱动的，cookie 的产生主要是为了解决 http 协议的无状态，web 服务器需要额外的数据用于维持会话，cookie 正是一一段随 http 请求的响应的额外数据，他的主要作用是标识用户维持会话</p><p>cookie 主要分为持久 cookie 和非持久 cookie，这两种分类的主要区别就是持久 cookie 是存储到客户端的磁盘中的只有到了过期时间或者手动删除才会失效，非辞旧 cookie 是存储到客户端的内存上的，浏览器关闭后就会消失</p><p><pre class="line-numbers language-none"><code class="language-none">cookie一般会经过加密，只有服务器的处理程序才知道cookie的含义<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>部分开发者将 cookie 作为用户的标识，那么我们就可以通过劫持 cookie 来登录账号，而部分开发者不会将 cookie 当作用户的标识，而是储存一些临时信息，那么我们拿到 cookie 也是没用的</p><h4 id="session"><a class="anchor" href="#session">#</a> session</h4><p>除去 cookie 外维持会话的另一种形式就是 session，session 在网络应用中被称为会话是一种服务端的机制，我们打开网站到关闭浏览器这段时间被称为会话，如果我们在服务端与客户端的会话没结束时就拿到 session 就能做到劫持会话的效果</p><h1 id="xss漏洞攻与防"><a class="anchor" href="#xss漏洞攻与防">#</a> xss 漏洞攻与防</h1><p>xss 跨站脚本漏洞的根本原因还是开发者对用户的输入输出没有进行严格的过滤，而导致的客户端脚本被浏览器正常执行导致，这也就意味着如果我们能够将敏感字符过滤就能够修补 xss 漏洞</p><h3 id="特定的标签过滤"><a class="anchor" href="#特定的标签过滤">#</a> 特定的标签过滤</h3><p>部分开发者认为将危险的标签过滤掉就不会执行 js 脚本，但是实际上任何一种标签无论是否合法都能够正常执行 js 脚本</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>not_real_tag onclick<span class="token operator">=</span><span class="token string">"alert(/xss/)"</span> <span class="token operator">></span>click me<span class="token operator">&lt;</span><span class="token operator">/</span>not_real_tag<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>像这样构造也能正常执行 xss 脚本，也就是说如果输出点在 HTML 标签中或者 js 脚本中，那么我们可以通过简单的闭合拼接属性那么就可以成功执行 xss</p><h3 id="事件过滤"><a class="anchor" href="#事件过滤">#</a> 事件过滤</h3><p>很多时候开发者者会选择过滤事件来防止 xss，但是不排除有漏网之鱼，这里可以 fuzz 尝试</p><p><pre class="line-numbers language-none"><code class="language-none">Fuzz字典分享:
onafterprint
oninput
onscrol1
onbeforeprint
oninvalid
onabort
onbeforeunload
onreset
oncanplay
onerror
onselect
oncanplaythrough
onhaschange
onsubmit
ondurationchange
onload
onkeydown
onemptied
onmessage
onkeypress
onended
onoffline
onkeyup
onerror
ononline
onclick
onloadeddata
onpagehide
ondblclick
onloadedmetadata
onpageshow
ondrag
onloadstart
onpopstate
ondragend
onpause
onredo
ondragenter
onplay
onresize
ondragleave
onplaying
onstorage
ondragover
onprogress
onundo
ondragstart
onratechange
onunload
ondrop
onreadystatechange
onblur
onmous edown
onseeked
onchange
onmous emove
onseeking
oncontextmenu
onmouseout
onstalled
onfocus
onmouseover
onsuspend
onformchange
onmouseup
ontimeupdate
onforminput
onmousewheel
onvolumechange<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>同样还有一些不属于事件属性，但可以用于执行 js 代码，比如常见的 js 伪协议</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>a herf<span class="token operator">=</span><span class="token string">"javascript:alert(/xss/)"</span><span class="token operator">></span>click me <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h3 id="敏感字符的过滤"><a class="anchor" href="#敏感字符的过滤">#</a> 敏感字符的过滤</h3><p>在 html 中，&lt;&gt;&quot; 和 '&amp; 都有特殊的意义，HTML 的标签属性就是由这几个字符组成的，如果直接输出可能会导致整个 HTML 文档的结构，所以我们通常情况将这些字符转义，比如 php 提供了 htmlspeciachars 和 htmlentities 两个函数把一些预定字符转义转换成 HTML 实体</p><ul><li>(&amp;) 成为 &amp; amp</li><li>(&quot;) 成为 &amp; quot</li><li>(') 成为 &amp;#039</li><li>(&lt;) 成为 &amp; lt</li><li>(&gt;) 成为 &amp; gt</li></ul><p>关键字过滤其实大部分是针对敏感变量或者函数进行的，如 eval，cookie 等，这部分的过滤可以通过字符串拼接，编码解码等方法绕过</p><h4 id="字符串拼接混淆"><a class="anchor" href="#字符串拼接混淆">#</a> 字符串拼接混淆</h4><p>js 中的对象方法可以通过数组的方式进行调用，比如调用 alert 函数</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">[</span><span class="token string">'alert'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">xss</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>这里数组的下标是先要调用函数名字的字符串，既然说是字符串那么就可以通过字符串拼接的方式</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">[</span><span class="token string">'al'</span><span class="token operator">+</span><span class="token string">'ert'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">xss</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>或者通过 js 自带的 base 编码来实现字符串的绕过</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">[</span><span class="token function">atob</span><span class="token punctuation">(</span><span class="token string">"YWxl"</span><span class="token operator">+</span><span class="token string">"cnQ="</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">xss</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="编码解码"><a class="anchor" href="#编码解码">#</a> 编码解码</h4><p>基于字符串的代码混淆不仅可以通过字符串拼接的方式，还可以通过各种编码的方式，常用的有：</p><ul><li>HTML 进制编码</li><li>css 进制编码</li><li>js 进制编码</li><li>url 编码</li><li>jsfuck 编码（一种只有<a href=""></a>！+6 个字符来编写 js 程序）</li></ul><h4 id="locationwindowname"><a class="anchor" href="#locationwindowname">#</a> location*,<span class="exturl" data-url="aHR0cDovL3dpbmRvdy5uYW1l">window.name</span></h4><p>既然开发者会对输入的敏感字符进行过滤，可以将 xss 脚本放到不会交付到服务端的部分</p><h4 id="过滤"><a class="anchor" href="#过滤">#</a> 过滤 &quot;.&quot;</h4><p>事件拼接都由点组成，可以过滤点来防御</p><p>但是在 js 中可以用 with 关键字设置变量的作用域。利用这个特性可以绕过点的过滤</p><p>with(document)with(cookie)</p><h4 id="过滤-2"><a class="anchor" href="#过滤-2">#</a> 过滤 &quot;()&quot;</h4><p>js 脚本中调用对象方法要使用 (), 使用 throw 关键字传递阐述可以绕过限制</p><p>window.onerror=alert; throw 1;</p><h4 id="过滤空格"><a class="anchor" href="#过滤空格">#</a> 过滤空格</h4><p>在标签属性间可以通过换行符 0x09、0x10、0x12、0x13、0x0a 等字符代替空格绕过过滤</p><p>&lt;img%0asrc=x%0aonerror=alert(/xss/)&gt;</p><p>在标签名称和第一个属性间也可以使用 &quot;/&quot; 代替空格</p><p>&lt;input/onfocus=alert(/xss/)&gt;</p><h3 id="httponly绕过"><a class="anchor" href="#httponly绕过">#</a> HTTPonly 绕过</h3><p>HTTPonly 是 cookie 的一个安全属性，设置后可以防止 xss 漏洞产生的时候避免 js 脚本获取到 cookie</p><h4 id="cve-2012-0053"><a class="anchor" href="#cve-2012-0053">#</a> cve-2012-0053</h4><p>Apache 服务器在 2.2.0-2.2.21 版本中存在一个漏洞，我们可以通过向网站植入一个超大的 cookie，令其 HTTP 头超过 Apache 的最大请求长度（4192 字节），使得 apache 返回 400 错误，状态也中包含了 HTTPonly 保护的 Cookie</p><h4 id="phpinfo页面"><a class="anchor" href="#phpinfo页面">#</a> phpinfo 页面</h4><p>无论设置是否设置了 HTTPonly 在 phpinfo 中都能看到 Cookie</p><div class="tags"><a href="/tags/XSS/" rel="tag"><i class="ic i-tag"></i> XSS</a></div></div><footer><div class="meta"></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Clown <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xcu.icu/2022/10/29/XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB/" title="XSS跨站脚本攻击">https://blog.xcu.icu/2022/10/29/XSS跨站脚本攻击/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/10/25/hexo+github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyhsblkj20zk0m81kx.jpg" title="hexo+github搭建个人博客"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 杂记</span><h3>hexo+github搭建个人博客</h3></a></div><div class="item right"><a href="/2022/10/31/CSRF&SSRF/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicliierfjj20zk0m8npd.jpg" title="CSRF&amp;SSRF"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Web</span><h3>CSRF&SSRF</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#xss%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB"><span class="toc-number">1.</span> <span class="toc-text">XSS 跨站脚本攻击</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%88%A8%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">原理刨析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xss%E5%88%86%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">xss 分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-number">3.0.1.</span> <span class="toc-text">反射型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-number">3.0.2.</span> <span class="toc-text">存储型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dom%E5%9E%8B"><span class="toc-number">3.0.3.</span> <span class="toc-text">DOM 型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dom%E5%9E%8Bxss%E5%88%A9%E7%94%A8%E5%8E%9F%E7%90%86"><span class="toc-number">3.0.3.1.</span> <span class="toc-text">DOM 型 xss 利用原理</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#xss%E7%9A%84%E6%A3%80%E6%B5%8B"><span class="toc-number">4.</span> <span class="toc-text">Xss 的检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%A3%80%E6%B5%8Bxss"><span class="toc-number">4.0.1.</span> <span class="toc-text">手工检测 xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E5%B7%A5%E5%85%B7"><span class="toc-number">4.0.2.</span> <span class="toc-text">Xss 工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xss%E7%9A%84%E5%88%A9%E7%94%A8%E7%A7%8D%E7%B1%BB"><span class="toc-number">5.</span> <span class="toc-text">Xss 的利用种类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%BC%9A%E8%AF%9D%E5%8A%AB%E6%8C%81"><span class="toc-number">5.0.1.</span> <span class="toc-text">xss 会话劫持</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie"><span class="toc-number">5.0.1.1.</span> <span class="toc-text">cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#session"><span class="toc-number">5.0.1.2.</span> <span class="toc-text">session</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xss%E6%BC%8F%E6%B4%9E%E6%94%BB%E4%B8%8E%E9%98%B2"><span class="toc-number">6.</span> <span class="toc-text">xss 漏洞攻与防</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%AE%9A%E7%9A%84%E6%A0%87%E7%AD%BE%E8%BF%87%E6%BB%A4"><span class="toc-number">6.0.1.</span> <span class="toc-text">特定的标签过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4"><span class="toc-number">6.0.2.</span> <span class="toc-text">事件过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E5%AD%97%E7%AC%A6%E7%9A%84%E8%BF%87%E6%BB%A4"><span class="toc-number">6.0.3.</span> <span class="toc-text">敏感字符的过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%B7%B7%E6%B7%86"><span class="toc-number">6.0.3.1.</span> <span class="toc-text">字符串拼接混淆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81"><span class="toc-number">6.0.3.2.</span> <span class="toc-text">编码解码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#locationwindowname"><span class="toc-number">6.0.3.3.</span> <span class="toc-text">location*,window.name</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">6.0.3.4.</span> <span class="toc-text">过滤 &quot;.&quot;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4-2"><span class="toc-number">6.0.3.5.</span> <span class="toc-text">过滤 &quot;()&quot;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC"><span class="toc-number">6.0.3.6.</span> <span class="toc-text">过滤空格</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#httponly%E7%BB%95%E8%BF%87"><span class="toc-number">6.0.4.</span> <span class="toc-text">HTTPonly 绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2012-0053"><span class="toc-number">6.0.4.1.</span> <span class="toc-text">cve-2012-0053</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phpinfo%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.0.4.2.</span> <span class="toc-text">phpinfo 页面</span></a></li></ol></li></ol></li></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/09/23/%E5%9F%BA%E4%BA%8Esql-labs%E9%9D%B6%E5%9C%BA%E7%9A%84SQL%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E8%BF%9B%E9%98%B6%E7%AF%87/" rel="bookmark" title="基于sqli-labs进阶学习">基于sqli-labs进阶学习</a></li><li><a href="/2022/09/23/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" rel="bookmark" title="报错注入">报错注入</a></li><li><a href="/2022/09/23/%E5%9F%BA%E4%BA%8Esqli-labs%E7%9A%84%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="bookmark" title="基于sqli-labs前20关的SQL注入学习">基于sqli-labs前20关的SQL注入学习</a></li><li><a href="/2022/10/24/awd-web%E5%B0%8F%E7%BB%93/" rel="bookmark" title="Awd-web小结">Awd-web小结</a></li><li><a href="/2022/10/24/user.ini%E5%92%8Chtaccess%E6%96%87%E4%BB%B6%E7%9A%84%E5%88%A9%E7%94%A8/" rel="bookmark" title="user.ini和htaccess文件的利用">user.ini和htaccess文件的利用</a></li><li><a href="/2022/10/24/sql%E6%B3%A8%E5%85%A5/" rel="bookmark" title="SQL注入">SQL注入</a></li><li><a href="/2022/10/24/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="bookmark" title="文件上传小结">文件上传小结</a></li><li class="active"><a href="/2022/10/29/XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB/" rel="bookmark" title="XSS跨站脚本攻击">XSS跨站脚本攻击</a></li><li><a href="/2022/10/31/CSRF&SSRF/" rel="bookmark" title="CSRF&SSRF">CSRF&SSRF</a></li><li><a href="/2022/11/02/php%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="php反序列化">php反序列化</a></li><li><a href="/2022/11/05/phpfilter%E7%9A%84%E7%BB%95exit/" rel="bookmark" title="php://filter过exit">php://filter过exit</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Clown" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Clown</p><div class="description" itemprop="description">一个妄想全栈web小废物的博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">10</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">20</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3duLXE=" title="https:&#x2F;&#x2F;github.com&#x2F;clown-q"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/10/25/hexo+github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/10/31/CSRF&SSRF/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2022/10/31/CSRF&SSRF/" title="CSRF&amp;SSRF">CSRF&SSRF</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTFshow/" title="分类于 CTFshow">CTFshow</a></div><span><a href="/2022/11/01/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="CTFshow-web入门命令执行">CTFshow-web入门命令执行</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8/" title="分类于 网络服务应用">网络服务应用</a></div><span><a href="/2022/10/24/nat%E6%A8%A1%E5%BC%8Fip%E5%88%86%E9%85%8D/" title="nat模式+ip分配">nat模式+ip分配</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2022/10/24/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" title="文件上传小结">文件上传小结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" title="分类于 渗透测试">渗透测试</a></div><span><a href="/2022/11/04/VulnHub%E9%9D%B6%E6%9C%BA%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Billu_b0x%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/" title="VulnHub靶机学习">VulnHub靶机学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%86%85%E7%BD%91/" title="分类于 内网">内网</a></div><span><a href="/2022/10/24/%E5%9F%9F%E7%8E%AF%E5%A2%83%E7%9A%84%E5%9F%BA%E7%A1%80%E5%92%8C%E6%90%AD%E5%BB%BA/" title="域环境基础和搭建">域环境基础和搭建</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8/" title="分类于 网络服务应用">网络服务应用</a></div><span><a href="/2022/11/03/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/" title="DNS服务器">DNS服务器</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2022/11/05/phpfilter%E7%9A%84%E7%BB%95exit/" title="php:&#x2F;&#x2F;filter过exit">php://filter过exit</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Web/" title="分类于 Web">Web</a></div><span><a href="/2022/09/23/%E5%9F%BA%E4%BA%8Esqli-labs%E7%9A%84%E5%9F%BA%E7%A1%80%E7%AF%87/" title="基于sqli-labs前20关的SQL注入学习">基于sqli-labs前20关的SQL注入学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%9D%82%E8%AE%B0/" title="分类于 杂记">杂记</a></div><span><a href="/2022/10/25/hexo+github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" title="hexo+github搭建个人博客">hexo+github搭建个人博客</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Clown @ ClownのBlog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/10/29/XSS跨站脚本攻击/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->